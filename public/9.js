(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"/3Rn":function(t,e,s){var a=s("1olg");"string"==typeof a&&(a=[[t.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};s("aET+")(a,i);a.locals&&(t.exports=a.locals)},"0/Cx":function(t,e,s){"use strict";s("/3Rn")},"1olg":function(t,e,s){(t.exports=s("I1BE")(!1)).push([t.i,".card[data-v-518ff46e]{margin-top:0!important}.card .card-header .card-category[data-v-518ff46e]{color:#f08b23}.white-content .card:not(.card-white) .card-header .card-title[data-v-518ff46e]{color:#0d274b;font-weight:600}.white--text[data-v-518ff46e]{color:#fff!important;caret-color:#fff!important}.active-tour[data-v-518ff46e]{background:#f08b23;border-radius:20px;padding:3px 20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.12),0 1px 5px 0 rgba(0,0,0,.2);font-weight:900;text-transform:uppercase;font-family:Open Sans}",""])},"LPg/":function(t,e,s){"use strict";s("qW7Q")},irWY:function(t,e,s){(t.exports=s("I1BE")(!1)).push([t.i,"#manager-profile .multiselect__option.multiselect__option--group.multiselect__option--disabled{text-align:center;background:#fff!important;color:#f08b23!important}#manager-profile .multiselect__option--highlight:after{background:rgba(240,139,35,0)}#manager-profile .multiselect__option--highlight{background:#f08b23}",""])},qW7Q:function(t,e,s){var a=s("irWY");"string"==typeof a&&(a=[[t.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};s("aET+")(a,i);a.locals&&(t.exports=a.locals)},uGPd:function(t,e,s){"use strict";s.r(e);var a=s("o0o1"),i=s.n(a);function n(t,e,s,a,i,n,o){try{var l=t[n](o),r=l.value}catch(t){return void s(t)}l.done?e(r):Promise.resolve(r).then(a,i)}function o(t){return function(){var e=this,s=arguments;return new Promise((function(a,i){var o=t.apply(e,s);function l(t){n(o,a,i,l,r,"next",t)}function r(t){n(o,a,i,l,r,"throw",t)}l(void 0)}))}}var l={name:"Main",data:function(){return{clients:0,managers:0,myclients:0,loading:!1,sms_loading:!1,message_type:{text:"Всем клиентам",value:"all"},options:[{text:"Всем клиентам",value:"all"},{text:"Одному клиенту",value:"one"},{text:"Клиентам из файла",value:"file"}],phone:"",phones:[],file:null,message:"Сообщение от TravelClub: ",email:"",info:null}},created:function(){},mounted:function(){this.getUser(),this.getStatistics(),this.branches.length<=0&&this.loadBranches()},computed:{menu:function(){return this.$store.getters.menu},isAdmin:function(){return this.$store.getters.isAdmin},user:function(){return this.$store.getters.user},branches:function(){return this.$store.getters.branches}},methods:{getUser:function(){var t=this;return o(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user&&null!=t.user){e.next=5;break}return e.next=3,t.$store.dispatch("getUser").then((function(){t.info=t.user.info,t.myclients=t.user.isManagerForCount}));case 3:e.next=7;break;case 5:t.info=t.user.info,t.myclients=t.user.isManagerForCount;case 7:case"end":return e.stop()}}),e)})))()},getStatistics:function(){var t=this;return o(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.get("auth/statistics").then((function(e){t.clients=e.data.clients,t.managers=e.data.managers}));case 2:case"end":return e.stop()}}),e)})))()},loadBranches:function(){var t=this;return o(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("setBranches");case 2:case"end":return e.stop()}}),e)})))()},selectCity:function(t){return o(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Department="";case 1:case"end":return e.stop()}}),e)})))()},updateInfo:function(){var t=this;this.loading=!0,this.info.FullName=this.info.LastName+" "+this.info.FirstName+" "+this.info.MiddleName;var e={id:this.user.id,value:this.user.email,key:"email"};this.$store.dispatch("saveUser",e),this.$store.dispatch("updateClientInfo",this.info).then((function(e){t.loading=!1,t.sendMessage("Ваши личные данные успешно обновлены")}))},changeMessageType:function(){this.phones=[],this.file=null},handleFiles:function(){var t=this.$refs.file.files;/\.(xlsx|xls)$/i.test(t[0].name)?this.file=t[0]:this.sendMessage("Неверный формат файла","error")},removeFile:function(){this.file=null},sendSms:function(){var t=this;if(this.sms_loading=!0,this.phones!==[]&&""!==this.message){if("all"===this.message_type.value&&axios.get("auth/manager/getPhones").then((function(e){t.phones=e.data.phones,t.sendMessage(e.data.message)})),"one"===this.message_type.value&&(this.phones=[],this.phones.push(this.phone)),"file"===this.message_type.value){var e=new FormData;e.append("file",this.file),axios.post("auth/manager/uploadPhones",e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){t.sendMessage(e.data.message),t.phones=e.data.phones,console.log(t.phones)}))}axios.post("auth/manager/sendSmsMessage",{message:this.message,phones:this.phones}).then((function(e){t.sendMessage(e.data.message)}))}this.sms_loading=!1},sendMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"travel";this.$notify({group:"info",type:e,title:"Сообщение от TravelClub",text:t})}},directives:{mask:s("OmDE").mask}},r=(s("0/Cx"),s("LPg/"),s("KHd+")),c=Object(r.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container m-auto",staticStyle:{height:"100%"},attrs:{id:"manager-profile"}},[s("div",{staticClass:"row w-100 mx-auto mb-4"},[t.isAdmin?s("div",{staticClass:"col-lg-4"},[s("div",{staticClass:"card card-chart mb-2"},[s("div",{staticClass:"card-header"},[s("h5",{staticClass:"card-category"},[t._v("Менеджеров")]),t._v(" "),s("h3",{staticClass:"card-title"},[t._v("\n                            "+t._s(t.managers)+"\n                        ")])])])]):t._e(),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("div",{staticClass:"card card-chart mb-2"},[s("div",{staticClass:"card-header"},[s("h5",{staticClass:"card-category"},[t._v("Клиентов")]),t._v(" "),s("h3",{staticClass:"card-title"},[t._v("\n                            "+t._s(t.clients)+"\n                        ")])])])])]),t._v(" "),s("div",{staticClass:"row w-100 mx-auto"},[t._m(0),t._v(" "),s("div",{staticClass:"col-lg-12"},[s("card",{staticClass:"mb-3"},[s("div",{staticClass:"lw-dashboard-card"},[s("div",{staticClass:"row p-2 m-auto",staticStyle:{width:"100%"}},[s("div",{staticClass:"col-md-12"},[s("label",{staticClass:"control-label"},[t._v("Выберите тип смс рассылки: ")]),t._v(" "),s("multiselect",{staticStyle:{"max-width":"300px"},attrs:{options:t.options,disabled:t.sms_loading,"option-height":25,placeholder:"Выберите тип смс рассылки","show-labels":!1,maxHeight:200,loading:t.sms_loading,"allow-empty":!1,label:"text"},on:{change:t.changeMessageType},scopedSlots:t._u([{key:"singleLabel",fn:function(e){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title",staticStyle:{"line-height":"1.428571"}},[t._v(t._s(e.option.text))])])]}},{key:"option",fn:function(e){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title",staticStyle:{"line-height":"1.428571"}},[t._v(t._s(e.option.text))])])]}}]),model:{value:t.message_type,callback:function(e){t.message_type=e},expression:"message_type"}}),t._v(" "),"one"==t.message_type.value?s("div",{staticClass:"text-center ml-auto mr-auto mt-3"},[s("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:["+# (###) ###-##-##","+## (###) ###-##-##"],expression:"['+# (###) ###-##-##','+## (###) ###-##-##']"}],attrs:{type:"text",placeholder:"Введите номер телефона клиента",name:"phone",required:"",disabled:t.sms_loading,pattern:"[\\+]\\d{2} [\\(]\\d{3}[\\)] \\d{3}[\\-]\\d{2}[\\-]\\d{2}"},model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}})],1):t._e(),t._v(" "),"file"==t.message_type.value?s("div",{staticClass:"ml-auto mr-auto"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-12 my-1"},[null==t.file?s("div",{staticClass:"filezone"},[s("input",{ref:"file",attrs:{type:"file",id:"file",disabled:t.sms_loading},on:{change:function(e){return t.handleFiles()}}}),t._v(" "),s("p",[t._v("\n                                                    Перетащите файл сюда "),s("br"),t._v("или нажмите для поиска\n                                                ")])]):t._e(),t._v(" "),null!=t.file?s("div",{staticClass:"list-group-item flex-column align-items-start",staticStyle:{"border-radius":"0.25rem"}},[s("div",{staticClass:"row pt-5 pb-5"},[s("div",{staticClass:"col-6"},[s("p",{staticClass:"mb-1"},[s("span",{staticClass:"amount"},[t._v("Файл: "+t._s(this.file.name))])])]),t._v(" "),s("div",{staticClass:"col-6"},[s("div",{staticClass:"remove-container",staticStyle:{float:"right"}},[s("a",{staticClass:"remove",staticStyle:{color:"red",cursor:"pointer"},on:{click:function(e){return t.removeFile()}}},[t._v("Удалить")])])])])]):t._e(),t._v(" "),s("hr")])])]):t._e()],1),t._v(" "),s("div",{staticClass:"col-md-12"},[s("label",{staticClass:"control-label"},[t._v("Сообщение: ")]),t._v(" "),s("div",{staticClass:"row w-100 text-center m-auto"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"w-100 p-2 m-auto travel-input",staticStyle:{"border-radius":"20px !important"},attrs:{id:"textarea",placeholder:"Введите сообщение...",rows:"4","max-rows":"8",disabled:t.sms_loading},domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value)}}})])])])]),t._v(" "),s("b-button",{staticClass:"btn btn-travel float-right",attrs:{slot:"footer",disabled:t.sms_loading},on:{click:t.sendSms},slot:"footer"},[s("div",{staticClass:"row align-items-center m-auto w-100 h-100"},[t.sms_loading?s("span",{staticClass:"spinner-border spinner-border-sm mx-2",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v(" "),t.sms_loading?s("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e(),t._v("\n                            Отправить\n                        ")])])],1)],1)]),t._v(" "),s("div",{staticClass:"row w-100 mx-auto"},[t._m(1),t._v(" "),s("div",{staticClass:"col-md-12"},[s("ValidationObserver",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.invalid;return[null!=t.user&&null!=t.info?s("card",[s("div",{staticClass:"row p-2 m-auto"},[s("div",{staticClass:"col-md-4 pr-md-1"},[s("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"lastName",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.errors;return[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Фамилия","label-size":"sm"}},[s("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Фамилия",placeholder:"Фамилия"},model:{value:t.info.LastName,callback:function(e){t.$set(t.info,"LastName",e)},expression:"info.LastName"}})],1),t._v(" "),s("span",{staticClass:"validate-error"},[t._v(t._s(a[0]))])]}}],null,!0)})],1),t._v(" "),s("div",{staticClass:"col-md-4 px-md-1"},[s("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"firstName",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.errors;return[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Имя","label-size":"sm"}},[s("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Имя",placeholder:"Имя"},model:{value:t.info.FirstName,callback:function(e){t.$set(t.info,"FirstName",e)},expression:"info.FirstName"}})],1),t._v(" "),s("span",{staticClass:"validate-error"},[t._v(t._s(a[0]))])]}}],null,!0)})],1),t._v(" "),s("div",{staticClass:"col-md-4 pl-md-1"},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Отчество","label-size":"sm"}},[s("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Отчество",placeholder:"Отчество"},model:{value:t.info.MiddleName,callback:function(e){t.$set(t.info,"MiddleName",e)},expression:"info.MiddleName"}})],1)],1)]),t._v(" "),s("div",{staticClass:"row p-2 m-auto"},[s("div",{staticClass:"col-md-4 pr-md-1"},[s("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"email",rules:"required|email"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.errors;return[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Email","label-size":"sm"}},[s("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Email",type:"email",placeholder:"client@email.com"},model:{value:t.user.email,callback:function(e){t.$set(t.user,"email",e)},expression:"user.email"}})],1),t._v(" "),s("span",{staticClass:"validate-error"},[t._v(t._s(a[0]))])]}}],null,!0)})],1),t._v(" "),s("div",{staticClass:"col-md-4 px-md-1"},[s("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"phone",rules:"required|phone"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.errors;return[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Телефон","label-size":"sm"}},[s("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:["+# (###) ###-##-##","+## (###) ###-##-##"],expression:"['+# (###) ###-##-##','+## (###) ###-##-##']"}],staticClass:"mb-0 travel-input",attrs:{label:"Телефон",placeholder:"Телефон"},model:{value:t.info.Phone,callback:function(e){t.$set(t.info,"Phone",e)},expression:"info.Phone"}})],1),t._v(" "),s("span",{staticClass:"validate-error"},[t._v(t._s(a[0]))])]}}],null,!0)})],1)]),t._v(" "),s("div",{staticClass:"row p-2 m-auto"},[s("div",{staticClass:"col-md-4 pr-md-1"},[s("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"City",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.errors;return[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Город","label-size":"sm"}},[s("multiselect",{attrs:{options:t.branches,"option-height":25,placeholder:"Выберите город","show-labels":!1,maxHeight:200,loading:0===t.branches.length,disabled:0===t.branches.length,"allow-empty":!1,"track-by":"city",label:"city"},on:{input:function(e){return t.selectCity(t.info)}},scopedSlots:t._u([{key:"singleLabel",fn:function(e){return[s("span",{staticClass:"option__desc"},[e.option.city?s("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[t._v(t._s(e.option.city))]):t._e()])]}},{key:"option",fn:function(e){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[t._v(t._s(e.option.city))])])]}}],null,!0),model:{value:t.info.City,callback:function(e){t.$set(t.info,"City",e)},expression:"info.City"}})],1),t._v(" "),s("span",{staticClass:"validate-error"},[t._v(t._s(a[0]))])]}}],null,!0)})],1),t._v(" "),s("div",{staticClass:"col-md-4 px-md-1"},[s("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"department",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.errors;return[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Отделение","label-size":"sm"}},[s("multiselect",{attrs:{options:t.info.City.departments,"option-height":25,placeholder:"Выберите отделение","show-labels":!1,maxHeight:200,disabled:0===t.info.City.departments.length,"allow-empty":!1,label:"address","track-by":"address"},scopedSlots:t._u([{key:"singleLabel",fn:function(e){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[t._v(t._s(e.option.address))])])]}},{key:"option",fn:function(e){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[t._v(t._s(e.option.address))])])]}}],null,!0),model:{value:t.info.Department,callback:function(e){t.$set(t.info,"Department",e)},expression:"info.Department"}})],1),t._v(" "),s("span",{staticClass:"validate-error"},[t._v(t._s(a[0]))])]}}],null,!0)})],1)]),t._v(" "),s("b-button",{staticClass:"btn btn-travel float-right",attrs:{slot:"footer",disabled:t.loading||a},on:{click:t.updateInfo},slot:"footer"},[s("div",{staticClass:"row align-items-center m-auto w-100 h-100"},[t.loading?s("span",{staticClass:"spinner-border spinner-border-sm mx-2",attrs:{role:"status","aria-hidden":"true"}}):t._e(),t._v(" "),t.loading?s("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e(),t._v("\n                                Сохранить\n                            ")])])],1):t._e()]}}])})],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-md-12"},[e("div",{staticClass:"row mx-auto mt-3 mb-5 justify-content-center align-items-center",staticStyle:{width:"100%","border-top":"4px solid #f08b23"}},[e("span",{staticClass:"white--text active-tour",staticStyle:{background:"#062348","font-size":"24px",position:"absolute"}},[this._v("Форма смс рассылки")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-md-12"},[e("div",{staticClass:"row mx-auto mt-3 mb-5 justify-content-center align-items-center",staticStyle:{width:"100%","border-top":"4px solid #f08b23"}},[e("span",{staticClass:"white--text active-tour",staticStyle:{background:"#062348","font-size":"24px",position:"absolute"}},[this._v("Профиль")])])])}],!1,null,"518ff46e",null);e.default=c.exports}}]);