/*! For license information please see 8513.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8513],{19997:(t,e,a)=>{a.d(e,{Z:()=>r});var s=a(1519),n=a.n(s)()((function(t){return t[1]}));n.push([t.id,".form-control[data-v-1deea1f8]:focus{background-color:#fff;border-color:#f08b23;box-shadow:0 0 0 .2rem rgba(240,139,35,.25);color:#495057;outline:0}.last_message[data-v-1deea1f8]{max-height:50px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.active[data-v-1deea1f8]{background:#f08b23!important;border-color:#f08b23!important}.scrollable[data-v-1deea1f8]{max-height:calc(100vh - 6.9rem);overflow-y:auto}.typer[data-v-1deea1f8]{align-items:center;background-color:#fff;border:2px solid #f08b23;border-radius:5px;bottom:0;box-sizing:border-box;display:flex;height:4.9rem;width:100%}.typer input[type=text][data-v-1deea1f8]{background-color:transparent;border:none;font-size:1.25rem;left:2.5rem;outline:none;padding:1rem;position:absolute;width:80%}.chat-container[data-v-1deea1f8]{background-color:#fff;box-sizing:border-box;height:calc(95vh - 9.5rem);overflow-y:auto;padding:10px}.message[data-v-1deea1f8]{margin-bottom:8px}.message.own[data-v-1deea1f8]{text-align:right}.message.own .content[data-v-1deea1f8]{background-color:#ffc890}.chat-container .username[data-v-1deea1f8]{font-size:18px;font-weight:700}.chat-container .content[data-v-1deea1f8]{word-wrap:break-word;background-color:#87cefa;border-radius:10px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);display:inline-block;max-width:50%;padding:8px}@media (max-width:480px){.chat-container .content[data-v-1deea1f8]{max-width:60%}}@media screen and (max-width:576px){.chat-container[data-v-1deea1f8]{height:calc(95vh - 6.8rem)}}[data-v-1deea1f8]::-webkit-file-upload-button{cursor:pointer}input[type=file][data-v-1deea1f8]{cursor:pointer;height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.preview[data-v-1deea1f8]{height:100%;max-width:90%}.paperclip-button[data-v-1deea1f8]{background:transparent;height:100%;max-height:45px;max-width:45px;overflow:hidden;position:relative;width:100%}.paperclip-button[data-v-1deea1f8],.paperclip-button[data-v-1deea1f8]:hover{border-color:#f08b23!important;color:#f08b23}.paperclip-button[data-v-1deea1f8]:active,.paperclip-button[data-v-1deea1f8]:focus{background:#f08b23!important;color:#fff!important}.paperclip-button[data-v-1deea1f8]:focus{outline:none!important}.audio-button[data-v-1deea1f8]{background-color:#f08b23;height:100%;max-height:45px;max-width:45px;width:100%}.audio-button[data-v-1deea1f8]:hover{background-color:#f08b23!important}",""]);const r=n},25611:(t,e,a)=>{a.d(e,{Z:()=>r});var s=a(1519),n=a.n(s)()((function(t){return t[1]}));n.push([t.id,".loading-wave-dots .wave-item:nth-child(2){animation-delay:.14s!important;margin-left:-20px}.loading-wave-dots[data-v-46b20d22] .wave-item:nth-child(3){animation-delay:.28s!important;margin-left:-4px}.loading-wave-dots[data-v-46b20d22] .wave-item:nth-child(4){animation-delay:.42s!important;margin-left:12px}.loading-wave-dots[data-v-46b20d22] .wave-item:last-child{animation-delay:.56s!important;margin-left:28px}.loading-wave-dots .wave-item{animation:wave-dots 2.8s linear infinite!important}@keyframes wave-dots{0%{background:#5b43f3;transform:translateY(0)}10%{background:#5b43f3;transform:translateY(-6px)}20%{background:#f3434b;transform:translateY(0)}to{background:#5b43f3;transform:translateY(0)}}",""]);const r=n},98513:(t,e,a)=>{a.r(e),a.d(e,{default:()=>g});function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function n(){n=function(){return e};var t,e={},a=Object.prototype,r=a.hasOwnProperty,i=Object.defineProperty||function(t,e,a){t[e]=a.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",d=o.toStringTag||"@@toStringTag";function u(t,e,a){return Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,a){return t[e]=a}}function h(t,e,a,s){var n=e&&e.prototype instanceof _?e:_,r=Object.create(n.prototype),o=new j(s||[]);return i(r,"_invoke",{value:M(t,a,o)}),r}function f(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var g="suspendedStart",p="suspendedYield",m="executing",v="completed",b={};function _(){}function w(){}function y(){}var x={};u(x,c,(function(){return this}));var C=Object.getPrototypeOf,k=C&&C(C(N([])));k&&k!==a&&r.call(k,c)&&(x=k);var S=y.prototype=_.prototype=Object.create(x);function F(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function D(t,e){function a(n,i,o,c){var l=f(t[n],t,i);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==s(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,o,c)}),(function(t){a("throw",t,o,c)})):e.resolve(u).then((function(t){d.value=t,o(d)}),(function(t){return a("throw",t,o,c)}))}c(l.arg)}var n;i(this,"_invoke",{value:function(t,s){function r(){return new e((function(e,n){a(t,s,e,n)}))}return n=n?n.then(r,r):r()}})}function M(e,a,s){var n=g;return function(r,i){if(n===m)throw new Error("Generator is already running");if(n===v){if("throw"===r)throw i;return{value:t,done:!0}}for(s.method=r,s.arg=i;;){var o=s.delegate;if(o){var c=L(o,s);if(c){if(c===b)continue;return c}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(n===g)throw n=v,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);n=m;var l=f(e,a,s);if("normal"===l.type){if(n=s.done?v:p,l.arg===b)continue;return{value:l.arg,done:s.done}}"throw"===l.type&&(n=v,s.method="throw",s.arg=l.arg)}}}function L(e,a){var s=a.method,n=e.iterator[s];if(n===t)return a.delegate=null,"throw"===s&&e.iterator.return&&(a.method="return",a.arg=t,L(e,a),"throw"===a.method)||"return"!==s&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+s+"' method")),b;var r=f(n,e.iterator,a.arg);if("throw"===r.type)return a.method="throw",a.arg=r.arg,a.delegate=null,b;var i=r.arg;return i?i.done?(a[e.resultName]=i.value,a.next=e.nextLoc,"return"!==a.method&&(a.method="next",a.arg=t),a.delegate=null,b):i:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,b)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function $(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function N(e){if(e||""===e){var a=e[c];if(a)return a.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function a(){for(;++n<e.length;)if(r.call(e,n))return a.value=e[n],a.done=!1,a;return a.value=t,a.done=!0,a};return i.next=i}}throw new TypeError(s(e)+" is not iterable")}return w.prototype=y,i(S,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:w,configurable:!0}),w.displayName=u(y,d,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,d,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},F(D.prototype),u(D.prototype,l,(function(){return this})),e.AsyncIterator=D,e.async=function(t,a,s,n,r){void 0===r&&(r=Promise);var i=new D(h(t,a,s,n),r);return e.isGeneratorFunction(a)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},F(S),u(S,d,"Generator"),u(S,c,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),a=[];for(var s in e)a.push(s);return a.reverse(),function t(){for(;a.length;){var s=a.pop();if(s in e)return t.value=s,t.done=!1,t}return t.done=!0,t}},e.values=N,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach($),!e)for(var a in this)"t"===a.charAt(0)&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var a=this;function s(s,n){return o.type="throw",o.arg=e,a.next=s,n&&(a.method="next",a.arg=t),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return s("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return s(i.catchLoc,!0);if(this.prev<i.finallyLoc)return s(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return s(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return s(i.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=t,i.arg=e,n?(this.method="next",this.next=n.finallyLoc,b):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),$(a),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var s=a.completion;if("throw"===s.type){var n=s.arg;$(a)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,a,s){return this.delegate={iterator:N(e),resultName:a,nextLoc:s},"next"===this.method&&(this.arg=t),b}},e}function r(t,e,a,s,n,r,i){try{var o=t[r](i),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(s,n)}function i(t){return function(){var e=this,a=arguments;return new Promise((function(s,n){var i=t.apply(e,a);function o(t){r(i,s,n,o,c,"next",t)}function c(t){r(i,s,n,o,c,"throw",t)}o(void 0)}))}}const o={data:function(){return{message_text:"",audio_record:null,image_record:null,file_record:null,message_mode:"text",preview:"",message_loading:!1,flag:!1,seconds:0,interval:"",files:[],currentChat:{},chatMessages:[],emojiPanel:!1,currentRef:{},loading:!1,totalChatHeight:0,search:"",results:[],options:{shouldSort:!0,threshold:.2,keys:["manager_title","client_title"]},new_chat:{name:"",user:null},load:!1}},mounted:function(){this.chatMessages=[],this.loadChat(),this.getUser(),console.log("this.chatMessages",this.chatMessages),console.log("this.currentChat",this.currentChat)},computed:{messages:function(){return this.chatMessages},chats:function(){return this.$store.getters.chats},user:function(){return this.$store.getters.user},available_users:function(){return this.$store.getters.available_users},filteredChats:function(){return""===this.search.trim()?this.chats:this.results}},watch:{"$route.params.id":function(t,e){console.log("here wattch"),this.loadChat()}},methods:{toChat:function(t){this.$router.push("/"+this.user.role+"/chat/"+t)},getUser:function(){var t=this;return i(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user){e.next=3;break}return e.next=3,t.$store.dispatch("getUser").then((function(){}));case 3:case"end":return e.stop()}}),e)})))()},loadChat:function(){var t=this;return i(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.chats.length<=0)){e.next=5;break}return e.next=3,t.$store.dispatch("loadUserChats").then((function(){t.totalChatHeight=t.$refs.chatContainer.scrollHeight,t.loading=!1,t.load=!0,void 0!==t.$route.params.id&&(t.chatMessages=[],t.currentChat=t.chats.find((function(e){if(e.id==t.$route.params.id)return!0})),t.currentChat.messages.forEach((function(e){t.onNewMessageAdded(e,!1)})))}));case 3:e.next=8;break;case 5:t.totalChatHeight=t.$refs.chatContainer.scrollHeight,t.loading=!1,void 0!==t.$route.params.id&&(t.chatMessages=[],t.currentChat=t.chats.find((function(e){if(e.id==t.$route.params.id)return!0})),t.currentChat.messages.forEach((function(e){t.onNewMessageAdded(e,!1)})));case 8:case"end":return e.stop()}}),e)})))()},onScroll:function(){if(this.$refs.chatContainer.scrollTop<100&&!this.loading){if(this.totalChatHeight=this.$refs.chatContainer.scrollHeight,this.loading=!0,void 0===this.chatMessages[0])return void(this.loading=!1);this.loading=!1}},processMessage:function(t){var e=/([^\s\']+).(?:jpg|jpeg|gif|png)/i;e.test(t.message_text)&&(t.image=e.exec(t.message_text)[0]);var a=/((?:[\u2600-\u27BF\u2934-\uD7FF\uE000-\uFFFF]|[\uD800-\uD83B][\uDC00-\uDFFF]|\uD83C[\uDC00-\uDD8E\uDD91-\uDE51\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F\uDE80-\uDEFF]|\uD83E[\uDD00-\uDDFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))/g;return a.test(t.message_text)&&(t.message_text=t.message_text.replace(a,'<span class="emoji">$1</span>')),t},onNewMessageAdded:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.message_text=t.message_text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),t.message_text=t.message_text.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,"<a href='$1'>$1</a>"),e?(this.chatMessages.push(t),console.log("newMessage"),this.scrollToEnd()):(this.chatMessages.push(t),console.log("!newMessage"),this.scrollTo())},sendChatMessage:function(t){var e=this;return i(n().mark((function a(){var s,r,i,o;return n().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:for(e.message_loading=!0,null!=e.audio_record&&e.files.push(e.audio_record),null!=e.image_record&&e.files.push(e.image_record),null!=e.file_record&&e.files.push(e.file_record),s={message_text:e.message_text,date:(new Date).toString(),conversation_id:e.currentChat.id,sender_id:e.user.id,type:t,files:e.files,senderInfo:e.user.info,selfMessage:!0},(r=new FormData).append("message",JSON.stringify(s)),i=0;i<e.files.length;i++)o=e.files[i].data,r.append("files["+i+"]",o);return a.next=10,e.$store.dispatch("sendMessage",r).then((function(t){e.onNewMessageAdded(t.data.message,!0),e.$store.commit("addChatMessage",t.data.message),e.message_loading=!1}));case 10:e.clearMessage();case 11:case"end":return a.stop()}}),a)})))()},scrollToEnd:function(){var t=this;this.$nextTick((function(){var e=t.$el.querySelector(".chat-container");e.scrollTop=e.scrollHeight}))},scrollTo:function(){var t=this;this.$nextTick((function(){var e=t.$refs.chatContainer.scrollHeight-t.totalChatHeight;t.$el.querySelector(".chat-container").scrollTop=e}))},addEmojiToMessage:function(t){this.message_text+=t.value},toggleEmojiPanel:function(){this.emojiPanel=!this.emojiPanel},onStream:function(t){console.log("before countSeconds"),this.countSeconds(),console.log("after countSeconds"),console.log("Got a stream object:",t),console.log("after stream object")},onResult:function(t){var e=Date.now(),a=new Date;this.audio_record={type:"audio",name:"record-"+e+".mp3",src:window.URL.createObjectURL(t),data:t,date:a,seconds:this.seconds},this.countSeconds(),this.message_mode="audio"},handleFile:function(){Date.now();var t=new Date,e=this.$refs.file.files;if(/\.(jpe?g|png|svg)$/i.test(e[0].name)){var a=new FileReader;a.addEventListener("load",function(){this.preview=a.result}.bind(this),!1),a.readAsDataURL(e[0]),this.image_record={type:"image",name:e[0].name,data:e[0],date:t},this.message_mode="image"}else/\.(pdf|txt|docx|doc)$/i.test(e[0].name)?(this.file_record={type:"file",name:e[0].name,data:e[0],date:t},this.message_mode="file",this.$nextTick((function(){this.preview="/images/LOGO-1.png"}))):(this.sendMessage("Неверный формат файла"),this.clearMessage())},clearMessage:function(){this.message_text="",this.image_record=null,this.audio_record=null,this.file_record=null,this.message_mode="text"},countSeconds:function(){console.log("this.flag 1",this.flag),this.flag=!this.flag,console.log("this.flag ",this.flag),1==this.flag?(this.seconds=0,this.interval=setInterval(this.incrementSeconds,1e3)):(clearInterval(this.interval),this.audio_record.seconds=this.seconds)},incrementSeconds:function(){this.seconds+=1},runSearch:function(){var t=this;""===this.search.trim()?this.results=this.chats:this.$search(this.search,this.chats,this.options).then((function(e){t.results=[],e.forEach((function(e){t.results.push(e)}))})),console.log(this.results)},open:function(){this.$bvModal.show("new-chat")},cancel:function(){this.$bvModal.hide("new-chat")},createChat:function(){var t=this;return i(n().mark((function e(){var a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,a={user_id:t.new_chat.user.id,name:t.new_chat.user.info.FullName},e.next=4,t.$store.dispatch("createChat",a).then((function(e){t.$store.commit("addChat",e.data.chat),t.$store.commit("removeAvailableUser",t.new_chat.user.id),t.loading=!1,t.new_chat={name:"",user:null},t.cancel()}));case 4:case"end":return e.stop()}}),e)})))()},sendMessage:function(t){this.$notify({group:"info",type:"travel",title:"Сообщение от TravelClub",text:t})}}};var c=a(93379),l=a.n(c),d=a(19997),u={insert:"head",singleton:!1};l()(d.Z,u);d.Z.locals;var h=a(25611),f={insert:"head",singleton:!1};l()(h.Z,f);h.Z.locals;const g=(0,a(51900).Z)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"container-fluid",staticStyle:{padding:"0"}},[e("b-modal",{attrs:{id:"new-chat",title:"Создать чат"},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[e("div",{staticClass:"w-100"},[e("b-button",{staticClass:"float-right",staticStyle:{background:"linear-gradient(0deg, #ffbf00 0%, #f08b23 100%)","background-color":"#f08b23 !important","border-color":"#f08b23 !important"},attrs:{disabled:null==t.new_chat.user||""==t.new_chat.user||t.loading},on:{click:t.createChat}},[t.loading?e("b-spinner",{attrs:{small:""}}):t._e(),t._v(" "),t.loading?e("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e(),t._v("\n                    Создать\n                ")],1),t._v(" "),e("b-button",{staticClass:"float-right mr-2",staticStyle:{background:"linear-gradient(0deg, #ffbf00 0%, #f08b23 100%)","background-color":"#f08b23 !important","border-color":"#f08b23 !important"},on:{click:t.cancel}},[t._v("\n                    Отмена\n                ")])],1)]},proxy:!0}])},[e("div",{staticClass:"row w-100 mt-2 mx-auto"},[e("multiselect",{staticStyle:{"line-height":"1.5","font-size":"0.765625rem",margin:"auto"},attrs:{placeholder:"Начать чат с...",optionHeight:29,showLabels:!1,options:t.available_users,multiple:!1,label:"info.FullName","track-by":"id",taggable:!0,searchable:!0,hideSelected:!0},scopedSlots:t._u([{key:"singleLabel",fn:function(a){return[e("span",{staticClass:"option__title"},[t._v(t._s(a.option.info.FullName))])]}},{key:"option",fn:function(a){return[e("span",{staticClass:"option__title"},[t._v(t._s(a.option.info.FullName))])]}}]),model:{value:t.new_chat.user,callback:function(e){t.$set(t.new_chat,"user",e)},expression:"new_chat.user"}})],1)]),t._v(" "),e("div",{staticClass:"row w-100 m-auto align-items-start justify-content-center"},[e("div",{staticClass:"col-sm-4 desktop scrollable",staticStyle:{position:"relative"}},[e("div",{staticClass:"row w-100 m-auto"},[e("div",{staticClass:"col-12 pt-3 px-0"},[e("div",{staticClass:"row w-100 mx-auto",staticStyle:{position:"sticky","z-index":"3",top:"0px"}},[e("div",{staticClass:"col-12 p-0"},[e("div",{staticClass:"row w-100 m-auto justify-content-center align-items-center py-2",staticStyle:{background:"#f08b23",color:"white","border-radius":"5px"}},[t._m(0),t._v(" "),e("div",{staticClass:"col-6 col-sm-6"},[t.available_users.length>0&&"client"!=t.user.role?e("span",{staticClass:"chat-name ml-auto mr-0",staticStyle:{"font-size":"25px",float:"right"},on:{click:t.open}},[e("b-icon",{attrs:{icon:"plus-circle-fill"}})],1):t._e()])])]),t._v(" "),e("div",{staticClass:"col-12 p-0"},[e("div",{staticClass:"row w-100 mx-auto mt-2"},[e("b-form-input",{staticClass:"mb-0 travel-input",attrs:{placeholder:"Поиск чата"},on:{input:t.runSearch},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)])])]),t._v(" "),t.chats.length<=0&&0==t.load?e("div",{staticClass:"col-12 pt-2 px-0"},[e("div",{staticClass:"row w-100 m-auto"},t._l(5,(function(a){return e("div",{key:a,staticClass:"col-12 skeleton-tr pt-2 px-0"},[e("div",{staticClass:"list-group"},[e("div",{staticClass:"list-group-item list-group-item-action flex-column align-items-start"},[e("div",{staticClass:"d-flex w-100 justify-content-between"},[e("div",{staticClass:"row m-auto w-100"},[e("div",{staticClass:"col-8 skeleton-tr p-2 mr-auto"},[e("tb-skeleton",{attrs:{height:15,theme:"opacity","bg-color":"#dcdbdc",shape:"radius"}})],1),t._v(" "),e("div",{staticClass:"col-2 skeleton-tr p-2 ml-auto float-right"},[e("tb-skeleton",{attrs:{height:15,theme:"opacity","bg-color":"#dcdbdc",shape:"radius"}})],1)])]),t._v(" "),e("div",[e("div",{staticClass:"row m-auto w-100"},[e("div",{staticClass:"col-4 skeleton-tr p-2"},[e("tb-skeleton",{attrs:{height:10,theme:"opacity","bg-color":"#dcdbdc",shape:"radius"}})],1)]),t._v(" "),e("div",{staticClass:"row m-auto w-100"},[e("div",{staticClass:"col-2 skeleton-tr p-2"},[e("tb-skeleton",{attrs:{height:5,theme:"opacity","bg-color":"#dcdbdc",shape:"radius"}})],1)])])])])])})),0)]):t._e(),t._v(" "),t.chats.length<=0&&1==t.load?e("div",{staticClass:"col-12 pt-2 px-0"},[t._m(1)]):t._e(),t._v(" "),t._l(t.filteredChats,(function(a){return e("div",{key:a.id,staticClass:"col-12 pt-2 px-0"},[e("div",{staticClass:"list-group"},[e("div",{staticClass:"list-group-item list-group-item-action flex-column align-items-start",class:{active:a.id==t.$route.params.id},staticStyle:{cursor:"pointer"},on:{click:function(e){return t.toChat(a.id)}}},[e("div",{staticClass:"d-flex w-100 justify-content-between"},[a.creator_id==t.user.id?e("h5",{staticClass:"mb-1"},[t._v(t._s(a.manager_title))]):e("h5",{staticClass:"mb-1"},[t._v(t._s(a.client_title))]),t._v(" "),a.messages.length>0?e("small",[t._v(t._s(t._f("moment")(a.messages[a.messages.length-1].created_at,"from","now")))]):t._e()]),t._v(" "),a.messages.length>0?e("div",[e("p",{staticClass:"mb-1 last_message"},[t._v(t._s(a.messages[a.messages.length-1].message_text))]),t._v(" "),e("small",[t._v(t._s(a.messages[a.messages.length-1].senderInfo.FirstName)+"\n                                    "),""!=a.messages[a.messages.length-1].senderInfo.MiddleName||null!=a.messages[a.messages.length-1].senderInfo.MiddleName?e("span",[t._v("\n                                        "+t._s(a.messages[a.messages.length-1].senderInfo.MiddleName)+"\n                                    ")]):t._e()])]):e("div",[e("p",{staticClass:"mb-1 last_message"},[t._v("В этой беседе ещё нет сообщений")])])])])])}))],2)]),t._v(" "),e("div",{staticClass:"col-12 col-md-8",staticStyle:{position:"relative"}},[e("div",{ref:"chatContainer",staticClass:"chat-container",on:{scroll:t.onScroll}},[e("message",{attrs:{messages:t.chatMessages}})],1),t._v(" "),"text"==t.message_mode?e("div",{staticClass:"typer"},[e("b-button",{staticClass:"rounded-circle border p-0 mx-1 paperclip-button",attrs:{disabled:t.message_loading}},[e("input",{ref:"file",attrs:{type:"file",id:"file"},on:{change:function(e){return t.handleFile()}}}),t._v(" "),e("b-icon",{attrs:{icon:"paperclip",scale:"2","aria-hidden":"true"}})],1),t._v(" "),e("b-form-textarea",{staticClass:"mx-1",attrs:{id:"textarea",size:"sm",placeholder:"Напишите сообщение...",rows:"1","max-rows":"2","no-resize":""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:(e.preventDefault(),t.sendChatMessage("text"))}},model:{value:t.message_text,callback:function(e){t.message_text=e},expression:"message_text"}}),t._v(" "),""==t.message_text.trim()&&"text"==t.message_mode?e("vue-record-audio",{staticClass:"audio-button mx-1",attrs:{mode:"press"},on:{stream:t.onStream,result:t.onResult}}):e("b-button",{staticClass:"audio-button rounded-circle p-2 mx-1 text-white border-0",attrs:{disabled:t.message_loading},on:{click:function(e){return t.sendChatMessage("text")}}},[t.message_loading?t._e():e("i",{staticClass:"bi-blank icon-send b-icon bi m-0 w-auto h-auto",staticStyle:{"font-size":"25px"}}),t._v(" "),t.message_loading?e("b-spinner",{attrs:{small:""}}):t._e(),t._v(" "),t.message_loading?e("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e()],1)],1):t._e(),t._v(" "),"image"==t.message_mode?e("div",{staticClass:"typer"},[e("b-button",{staticClass:"rounded-circle border p-0 mx-1 paperclip-button",attrs:{disabled:t.message_loading},on:{click:t.clearMessage}},[e("b-icon",{attrs:{icon:"x",scale:"2","aria-hidden":"true"}})],1),t._v(" "),e("div",{staticClass:"row m-auto p-2 w-100 h-100 align-items-center justify-content-center"},[e("div",{staticClass:"col-4 h-100 text-center"},[e("img",{staticClass:"preview",attrs:{src:t.preview}})]),t._v(" "),e("div",{staticClass:"col-8 p-0 p-sm-1 p-md-2 h-100"},[e("div",{staticStyle:{"text-overflow":"ellipsis",overflow:"hidden",width:"100%",height:"100%"}},[t._v(t._s(t.image_record.name))])])]),t._v(" "),e("b-button",{staticClass:"audio-button rounded-circle p-2 mx-1 text-white border-0",attrs:{disabled:t.message_loading},on:{click:function(e){return t.sendChatMessage("image")}}},[t.message_loading?t._e():e("i",{staticClass:"bi-blank icon-send b-icon bi m-0 w-auto h-auto",staticStyle:{"font-size":"25px"}}),t._v(" "),t.message_loading?e("b-spinner",{attrs:{small:""}}):t._e(),t._v(" "),t.message_loading?e("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e()],1)],1):t._e(),t._v(" "),"file"==t.message_mode?e("div",{staticClass:"typer"},[e("b-button",{staticClass:"rounded-circle border p-0 mx-1 paperclip-button",attrs:{disabled:t.message_loading},on:{click:t.clearMessage}},[e("b-icon",{attrs:{icon:"x",scale:"2","aria-hidden":"true"}})],1),t._v(" "),e("div",{staticClass:"row m-auto p-2 w-100 h-100 align-items-center justify-content-center"},[e("div",{staticClass:"col-4 h-100 text-center"},[e("img",{staticClass:"preview",attrs:{src:t.preview}})]),t._v(" "),e("div",{staticClass:"col-8 p-0 p-sm-1 p-md-2 h-100"},[e("div",{staticStyle:{"text-overflow":"ellipsis",overflow:"hidden",width:"100%",height:"100%"}},[t._v(t._s(t.file_record.name))])])]),t._v(" "),e("b-button",{staticClass:"audio-button rounded-circle p-2 mx-1 text-white border-0",attrs:{disabled:t.message_loading},on:{click:function(e){return t.sendChatMessage("file")}}},[t.message_loading?t._e():e("i",{staticClass:"bi-blank icon-send b-icon bi m-0 w-auto h-auto",staticStyle:{"font-size":"25px"}}),t._v(" "),t.message_loading?e("b-spinner",{attrs:{small:""}}):t._e(),t._v(" "),t.message_loading?e("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e()],1)],1):t._e(),t._v(" "),"audio"==t.message_mode?e("div",{staticClass:"typer justify-content-between"},[e("b-button",{staticClass:"rounded-circle border p-0 mx-1 paperclip-button",attrs:{disabled:t.message_loading},on:{click:t.clearMessage}},[e("b-icon",{attrs:{icon:"x",scale:"2","aria-hidden":"true"}})],1),t._v(" "),e("audio-player",{staticStyle:{width:"60%"},attrs:{audio:t.audio_record,type:"file"}}),t._v(" "),e("b-button",{staticClass:"audio-button rounded-circle p-2 mx-1 text-white border-0",attrs:{disabled:t.message_loading},on:{click:function(e){return t.sendChatMessage("audio")}}},[t.message_loading?t._e():e("i",{staticClass:"bi-blank icon-send b-icon bi m-0 w-auto h-auto",staticStyle:{"font-size":"25px"}}),t._v(" "),t.message_loading?e("b-spinner",{attrs:{small:""}}):t._e(),t._v(" "),t.message_loading?e("span",{staticClass:"sr-only"},[t._v("Loading...")]):t._e()],1)],1):t._e()])])],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"col-6 col-sm-6"},[t("p",{staticClass:"my-auto"},[t("span",{staticClass:"chat-name"},[this._v("Чаты")])])])},function(){var t=this._self._c;return t("div",{staticClass:"row w-100 mx-auto mb-2"},[t("p",[this._v("Пока у Вас нет никаких чатов")])])}],!1,null,"1deea1f8",null).exports}}]);