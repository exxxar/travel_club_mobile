/*! For license information please see 9140.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9140],{17923:(e,n,t)=>{t.d(n,{A:()=>o});var s=t(45627),a=t.n(s),i=t(76798),r=t.n(i)()(a());r.push([e.id,".card[data-v-faa0a646]{margin-top:0!important}.card .card-header .card-category[data-v-faa0a646]{color:#f08b23}.white-content .card:not(.card-white) .card-header .card-title[data-v-faa0a646]{color:#0d274b;font-weight:600}.white--text[data-v-faa0a646]{caret-color:#fff!important;color:#fff!important}.active-tour[data-v-faa0a646]{background:#f08b23;border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.12),0 1px 5px 0 rgba(0,0,0,.2);font-family:Open Sans;font-weight:900;padding:3px 20px;text-transform:uppercase}","",{version:3,sources:["webpack://./resources/js/desktop/pages/Manager/Main.vue"],names:[],mappings:"AAyhBA,uBACA,sBACA,CACA,mDACA,aACA,CACA,gFACA,aAAA,CACA,eACA,CACA,8BAEA,0BAAA,CADA,oBAEA,CACA,8BACA,kBAAA,CACA,kBAAA,CAGA,gGAAA,CAGA,qBAAA,CAFA,eAAA,CAHA,gBAAA,CAIA,wBAEA",sourcesContent:['<template>\n    <div class="container m-auto" id="manager-profile" style="height: 100%;">\n        <div class="row w-100 mx-auto mb-4">\n            <div class="col-lg-4" v-if="isAdmin">\n                <div class="card card-chart mb-2">\n                    <div class="card-header">\n                        <h5 class="card-category">Менеджеров</h5>\n                        <h3 class="card-title">\n                            {{managers}}\n                        </h3>\n                    </div>\n                </div>\n            </div>\n            <div class="col-lg-4">\n                <div class="card card-chart mb-2">\n                    <div class="card-header">\n                        <h5 class="card-category">Клиентов</h5>\n                        <h3 class="card-title">\n                            {{clients}}\n                        </h3>\n                    </div>\n                </div>\n            </div>\n\x3c!--            <div class="col-lg-4">--\x3e\n\x3c!--                <div class="card card-chart">--\x3e\n\x3c!--                    <div class="card-header">--\x3e\n\x3c!--                        <h5 class="card-category">Моих клиентов</h5>--\x3e\n\x3c!--                        <h3 class="card-title">--\x3e\n\x3c!--                            {{myclients}}--\x3e\n\x3c!--                        </h3>--\x3e\n\x3c!--                    </div>--\x3e\n\x3c!--                </div>--\x3e\n\x3c!--            </div>--\x3e\n        </div>\n        <div class="row w-100 mx-auto">\n            <div class="col-md-12">\n                <div class="row mx-auto mt-3 mb-5 justify-content-center align-items-center" style="width: 100%;border-top: 4px solid #f08b23;">\n                    <span class="white--text active-tour" style="background:#062348; font-size: 24px;position: absolute">Форма смс рассылки</span>\n                </div>\n            </div>\n            <div class="col-lg-12">\n                <card class="mb-3">\n                    <div class="lw-dashboard-card">\n                        <div class="row p-2 m-auto" style="width:100%;">\n                            <div class="col-md-12">\n                                <label class="control-label">Выберите тип смс рассылки: </label>\n                                <multiselect\n                                    v-model="message_type"\n                                    :options="options"\n                                    @change="changeMessageType"\n                                    :disabled="sms_loading"\n                                    :option-height="25"\n                                    placeholder="Выберите тип смс рассылки"\n                                    :show-labels="false"\n                                    :maxHeight="200"\n                                    :loading="sms_loading"\n                                    :allow-empty="false"\n                                    label="text"\n                                    style="max-width: 300px"\n                                >\n                                    <template slot="singleLabel" slot-scope="props">\n                                        <span class="option__desc">\n                                            <span class="option__title" style="line-height: 1.428571">{{ props.option.text}}</span>\n                                        </span>\n                                    </template>\n                                    <template slot="option" slot-scope="props">\n                                        <span class="option__desc">\n                                            <span class="option__title" style="line-height: 1.428571">{{ props.option.text }}</span>\n                                        </span>\n                                    </template>\n                                </multiselect>\n                                <div class="text-center ml-auto me-auto mt-3" v-if="message_type.value==\'one\'">\n                                    <b-form-input\n                                        type="text"\n                                        placeholder="Введите номер телефона клиента"\n                                        name="phone"\n                                        v-model="phone"\n                                        required\n                                        :disabled="sms_loading"\n                                        pattern="[\\+]\\d{2} [\\(]\\d{3}[\\)] \\d{3}[\\-]\\d{2}[\\-]\\d{2}"\n                                        v-mask="[\'+# (###) ###-##-##\',\'+## (###) ###-##-##\']"\n                                    >\n                                    </b-form-input>\n\n                                </div>\n                                <div class="ml-auto me-auto" v-if="message_type.value==\'file\'">\n                                    <div class="row">\n                                        <div class="col-lg-12 my-1">\n                                            <div class="filezone" v-if="file==null">\n                                                <input type="file" id="file" ref="file" v-on:change="handleFiles()" :disabled="sms_loading"/>\n                                                <p>\n                                                    Перетащите файл сюда <br>или нажмите для поиска\n                                                </p>\n                                            </div>\n                                            <div class="list-group-item flex-column align-items-start" style="border-radius: 0.25rem;" v-if="file!=null">\n                                                <div class="row pt-5 pb-5">\n                                                    <div class="col-6">\n                                                        <p class="mb-1">\n                                                            <span class="amount">Файл: {{this.file.name}}</span>\n                                                        </p>\n                                                    </div>\n                                                    <div class="col-6">\n                                                        <div class="remove-container" style="float: right;">\n                                                            <a class="remove" style="color: red;cursor: pointer;" v-on:click="removeFile()">Удалить</a>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <hr>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="col-md-12">\n                                <label class="control-label">Сообщение: </label>\n                                <div class="row w-100 text-center m-auto">\n                                    <textarea\n                                        id="textarea"\n                                        v-model="message"\n                                        placeholder="Введите сообщение..."\n                                        rows="4"\n                                        max-rows="8"\n                                        class="w-100 p-2 m-auto travel-input"\n                                        style="border-radius: 20px !important;"\n                                        :disabled="sms_loading">\n                                    </textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                    </div>\n                 \x3c!--   <div class="row justify-content-center mt-3 mb-4 text-center" slot="footer">--\x3e\n                    <b-button class="btn btn-travel float-right" slot="footer" @click="sendSms" :disabled="sms_loading">\n                        <div class="row align-items-center m-auto w-100 h-100">\n                            <span v-if="sms_loading" role="status" aria-hidden="true" class="spinner-border spinner-border-sm mx-2"></span>\n                            <span v-if="sms_loading" class="sr-only">Loading...</span>\n                            Отправить\n                        </div>\n                    </b-button>\n                    \x3c!--                        </div>--\x3e\n                </card>\n            </div>\n        </div>\n        <div class="row w-100 mx-auto">\n            <div class="col-md-12">\n                <div class="row mx-auto mt-3 mb-5 justify-content-center align-items-center" style="width: 100%;border-top: 4px solid #f08b23;">\n                    <span class="white--text active-tour" style="background:#062348; font-size: 24px;position: absolute">Профиль</span>\n                </div>\n            </div>\n            <div class="col-md-12">\n                <ValidationObserver v-slot="{ invalid }">\n                    <card v-if="user != null && info != null">\n                        <div class="row p-2 m-auto">\n                            <div class="col-md-4 pe-md-1">\n                                <ValidationProvider name="lastName" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Фамилия" label-size="sm" class="mb-0">\n                                        <b-form-input label="Фамилия"\n                                                    v-model="info.LastName"\n                                                    placeholder="Фамилия"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 px-md-1">\n                                <ValidationProvider name="firstName" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Имя" label-size="sm" class="mb-0">\n                                        <b-form-input label="Имя"\n                                                    v-model="info.FirstName"\n                                                    placeholder="Имя"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 ps-md-1">\n                                <b-form-group label="Отчество" label-size="sm" class="mb-0">\n                                    <b-form-input label="Отчество"\n                                                v-model="info.MiddleName"\n                                                placeholder="Отчество"\n                                                class="mb-0 travel-input"\n                                    >\n                                    </b-form-input>\n                                </b-form-group>\n                            </div>\n                        </div>\n                        <div class="row p-2 m-auto">\n\x3c!--                            <div class="col-md-4 pe-md-1">--\x3e\n\x3c!--                                <ValidationProvider name="login" rules="required" v-slot="{ errors }" style="width:100%;">--\x3e\n\x3c!--                                    <b-form-input label="Логин"--\x3e\n\x3c!--                                                placeholder="Логин"--\x3e\n\x3c!--                                                v-model="user.login"--\x3e\n\x3c!--                                                disabled--\x3e\n\x3c!--                                                class="mb-0"--\x3e\n\x3c!--                                    >--\x3e\n\x3c!--                                    </b-form-input>--\x3e\n\x3c!--                                    <span class="validate-error">{{ errors[0] }}</span>--\x3e\n\x3c!--                                </ValidationProvider>--\x3e\n\x3c!--                            </div>--\x3e\n                            <div class="col-md-4 pe-md-1">\n                                <ValidationProvider name="email" rules="required|email" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Email" label-size="sm" class="mb-0">\n                                        <b-form-input label="Email"\n                                                    type="email"\n                                                    placeholder="client@email.com"\n                                                    v-model="user.email"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 px-md-1">\n                                <ValidationProvider name="phone" rules="required|phone" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Телефон" label-size="sm" class="mb-0">\n                                        <b-form-input label="Телефон"\n                                                    placeholder="Телефон"\n                                                    v-model="info.Phone"\n                                                      v-mask="[\'+# (###) ###-##-##\',\'+## (###) ###-##-##\']"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                        </div>\n                        <div class="row p-2 m-auto">\n                            <div class="col-md-4 pe-md-1">\n                                <ValidationProvider name="City" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Город" label-size="sm" class="mb-0">\n                                        <multiselect\n                                            v-model="info.City"\n                                            :options="branches"\n                                            :option-height="25"\n                                            placeholder="Выберите город"\n                                            :show-labels="false"\n                                            :maxHeight="200"\n                                            :loading="branches.length===0"\n                                            :disabled="branches.length===0"\n                                            :allow-empty="false"\n                                            track-by="city"\n                                            label="city"\n                                            @input="selectCity(info)"\n                                        >\n                                            <template slot="singleLabel" slot-scope="props">\n                                                <span class="option__desc">\n                                                    <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571" v-if="props.option.city">{{ props.option.city}}</span>\n                                                </span>\n                                            </template>\n                                            <template slot="option" slot-scope="props">\n                                                <span class="option__desc">\n                                                    <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571">{{ props.option.city}}</span>\n                                                </span>\n                                            </template>\n                                        </multiselect>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 px-md-1">\n                                <ValidationProvider name="department" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Отделение" label-size="sm" class="mb-0">\n                                        <multiselect\n                                            v-model="info.Department"\n                                            :options="info.City.departments"\n                                            :option-height="25"\n                                            placeholder="Выберите отделение"\n                                            :show-labels="false"\n                                            :maxHeight="200"\n                                            :disabled="info.City.departments.length===0"\n                                            :allow-empty="false"\n                                            label="address"\n                                            track-by="address"\n                                        >\n                                            <template slot="singleLabel" slot-scope="props">\n                                                    <span class="option__desc">\n                                                        <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571">{{ props.option.address}}</span>\n                                                    </span>\n                                            </template>\n                                            <template slot="option" slot-scope="props">\n                                                    <span class="option__desc">\n                                                        <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571">{{ props.option.address }}</span>\n                                                    </span>\n                                            </template>\n                                        </multiselect>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                        </div>\n                        <b-button class="btn btn-travel float-right" slot="footer" @click="updateInfo" :disabled="loading || invalid">\n                            <div class="row align-items-center m-auto w-100 h-100">\n                                <span v-if="loading" role="status" aria-hidden="true" class="spinner-border spinner-border-sm mx-2"></span>\n                                Сохранить\n                            </div>\n                        </b-button>\n                    </card>\n                </ValidationObserver>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    import {mask} from \'vue-the-mask\'\n    export default {\n        name: "Main",\n        data() {\n            return {\n                clients:0,\n                managers: 0,\n                myclients:0,\n                loading:false,\n                sms_loading: false,\n                message_type: { text: \'Всем клиентам\', value: \'all\' },\n                options: [\n                    { text: \'Всем клиентам\', value: \'all\' },\n                    { text: \'Одному клиенту\', value: \'one\' },\n                    { text: \'Клиентам из файла\', value: \'file\' }\n                ],\n                phone:\'\',\n                phones: [],\n                file: null,\n                message: \'Сообщение от TravelClub: \',\n                email:\'\',\n                info:null,\n            }\n        },\n        created() {\n\n        },\n        mounted() {\n            this.getUser();\n            this.getStatistics();\n            if(this.branches.length<=0){\n                this.loadBranches();\n            }\n            // if(!this.user || this.user==null)\n            // {\n            //     this.$store.dispatch(\'getUser\').then( () => {\n            //         // this.myclients = this.user.isManagerForCount;\n            //     });\n            // }\n\n            // this.myclients = this.user.isManagerForCount;\n        },\n        computed:\n            {\n                menu() {\n                    return this.$store.getters.menu\n                },\n                isAdmin : function(){ return this.$store.getters.isAdmin},\n                user() {\n                    return this.$store.getters.user\n                },\n                branches(){\n                    return this.$store.getters.branches\n                }\n                // fullName() {\n                //     return this.info.LastName+\' \'+ this.info.FirstName+\' \'+this.info.MiddleName\n                // }\n            },\n        methods: {\n            async getUser() {\n\n                if(!this.user || this.user==null)\n                {\n                    await this.$store.dispatch(\'getUser\').then( () => {\n                        // console.log(\'getUser\')\n                        this.info = this.user.info;\n                        this.myclients = this.user.isManagerForCount;\n                    });\n\n                }\n                else {\n                    this.info = this.user.info;\n                    this.myclients = this.user.isManagerForCount;\n                }\n            },\n            async getStatistics() {\n                await axios.get(\'auth/statistics\').then((resp) => {\n                    this.clients = resp.data.clients;\n                    this.managers = resp.data.managers\n                });\n            },\n            async loadBranches() {\n                await this.$store.dispatch(\'setBranches\')\n            },\n            async selectCity(item) {\n                item.Department = \'\';\n            },\n\n            //info\n            updateInfo() {\n                this.loading=true;\n                this.info.FullName = this.info.LastName+\' \'+ this.info.FirstName+\' \'+this.info.MiddleName;\n                var param = {\n                    id: this.user.id,\n                    value: this.user.email,\n                    key: \'email\',\n                }\n                this.$store.dispatch(\'saveUser\', param)\n                this.$store.dispatch(\'updateClientInfo\', this.info)\n                    .then(response => {\n                        this.loading= false;\n\n                        // let foundIndex = this.addresses.findIndex(item => item.department === this.info.Department);\n                        // this.department = this.addresses[foundIndex]\n                        this.sendMessage(\'Ваши личные данные успешно обновлены\');\n                    });\n            },\n\n            changeMessageType(){\n                this.phones=[];\n                this.file = null;\n            },\n            handleFiles() {\n                let uploadedFiles = this.$refs.file.files;\n                if (/\\.(xlsx|xls)$/i.test(uploadedFiles[0].name))\n                {\n                    this.file = uploadedFiles[0];\n                }\n                else\n                {\n                    this.sendMessage(\'Неверный формат файла\', \'error\')\n                }\n\n            },\n            removeFile(){\n                this.file = null;\n            },\n            sendSms() {\n                this.sms_loading = true;\n                if(this.phones !== [] && this.message !== \'\')\n                {\n                    if(this.message_type.value === \'all\'){\n                        axios\n                            .get(`auth/manager/getPhones`)\n                            .then(resp => {\n                                this.phones = resp.data.phones;\n                                this.sendMessage(resp.data.message);\n                            });\n                    }\n                    if(this.message_type.value === \'one\'){\n                        this.phones = [];\n                        this.phones.push(this.phone);\n                    }\n                    if(this.message_type.value === \'file\'){\n                        let formData = new FormData();\n                        formData.append(\'file\', this.file);\n                        axios.post(`auth/manager/uploadPhones`,\n                            formData,\n                            {\n                                headers: {\n                                    \'Content-Type\': \'multipart/form-data\'\n                                }\n                            })\n                            .then(resp => {\n                                this.sendMessage(resp.data.message);\n                                this.phones = resp.data.phones;\n                                console.log(this.phones)\n                            });\n                    }\n                    axios.post(`auth/manager/sendSmsMessage`, {\n                        message: this.message,\n                        phones: this.phones\n                    }).then(resp => {\n                        this.sendMessage(resp.data.message);\n                    });\n                }\n                this.sms_loading = false;\n            },\n            sendMessage(message, type=\'travel\') {\n                this.$notify({\n                    group: \'info\',\n                    type: type,\n                    title: \'Сообщение от TravelClub\',\n                    text: message\n                });\n            },\n        },\n        directives: {mask}\n\n    }\n<\/script>\n\x3c!--<style scoped lang="scss" src="@/sass/black-dashboard.scss">--\x3e\n\n\x3c!--</style>--\x3e\n<style scoped>\n    .card {\n        margin-top: 0 !important;\n    }\n    .card .card-header .card-category {\n        color: #F08B23;\n    }\n    .white-content .card:not(.card-white) .card-header .card-title {\n        color: #0d274b;\n        font-weight: 600;\n    }\n    .white--text {\n        color: #fff !important;\n        caret-color: #fff !important;\n    }\n    .active-tour {\n        background: #f08b23;\n        border-radius: 20px;\n        padding: 3px 20px;\n        -webkit-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);\n        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);\n        font-weight: 900;\n        text-transform: uppercase;\n        font-family: \'Open Sans\';\n    }\n</style>\n<style>\n    /*#manager-profile .multiselect__tags {*/\n    /*    border-color: rgba(29, 37, 59, 0.5) !important;*/\n    /*}*/\n    #manager-profile .multiselect__option.multiselect__option--group.multiselect__option--disabled{\n        text-align: center;\n        background: white !important;\n        color:#f08b23 !important;\n    }\n    #manager-profile .multiselect__option--highlight::after {\n        background: #f08b2300;\n    }\n    #manager-profile .multiselect__option--highlight{\n        background: #f08b23;\n    }\n</style>\n'],sourceRoot:""}]);const o=r},51319:(e,n,t)=>{t.d(n,{A:()=>o});var s=t(45627),a=t.n(s),i=t(76798),r=t.n(i)()(a());r.push([e.id,"#manager-profile .multiselect__option.multiselect__option--group.multiselect__option--disabled{background:#fff!important;color:#f08b23!important;text-align:center}#manager-profile .multiselect__option--highlight:after{background:#f08b2300}#manager-profile .multiselect__option--highlight{background:#f08b23}","",{version:3,sources:["webpack://./resources/js/desktop/pages/Manager/Main.vue"],names:[],mappings:"AA4hBA,+FAEA,yBAAA,CACA,uBAAA,CAFA,iBAGA,CACA,uDACA,oBACA,CACA,iDACA,kBACA",sourcesContent:['<template>\n    <div class="container m-auto" id="manager-profile" style="height: 100%;">\n        <div class="row w-100 mx-auto mb-4">\n            <div class="col-lg-4" v-if="isAdmin">\n                <div class="card card-chart mb-2">\n                    <div class="card-header">\n                        <h5 class="card-category">Менеджеров</h5>\n                        <h3 class="card-title">\n                            {{managers}}\n                        </h3>\n                    </div>\n                </div>\n            </div>\n            <div class="col-lg-4">\n                <div class="card card-chart mb-2">\n                    <div class="card-header">\n                        <h5 class="card-category">Клиентов</h5>\n                        <h3 class="card-title">\n                            {{clients}}\n                        </h3>\n                    </div>\n                </div>\n            </div>\n\x3c!--            <div class="col-lg-4">--\x3e\n\x3c!--                <div class="card card-chart">--\x3e\n\x3c!--                    <div class="card-header">--\x3e\n\x3c!--                        <h5 class="card-category">Моих клиентов</h5>--\x3e\n\x3c!--                        <h3 class="card-title">--\x3e\n\x3c!--                            {{myclients}}--\x3e\n\x3c!--                        </h3>--\x3e\n\x3c!--                    </div>--\x3e\n\x3c!--                </div>--\x3e\n\x3c!--            </div>--\x3e\n        </div>\n        <div class="row w-100 mx-auto">\n            <div class="col-md-12">\n                <div class="row mx-auto mt-3 mb-5 justify-content-center align-items-center" style="width: 100%;border-top: 4px solid #f08b23;">\n                    <span class="white--text active-tour" style="background:#062348; font-size: 24px;position: absolute">Форма смс рассылки</span>\n                </div>\n            </div>\n            <div class="col-lg-12">\n                <card class="mb-3">\n                    <div class="lw-dashboard-card">\n                        <div class="row p-2 m-auto" style="width:100%;">\n                            <div class="col-md-12">\n                                <label class="control-label">Выберите тип смс рассылки: </label>\n                                <multiselect\n                                    v-model="message_type"\n                                    :options="options"\n                                    @change="changeMessageType"\n                                    :disabled="sms_loading"\n                                    :option-height="25"\n                                    placeholder="Выберите тип смс рассылки"\n                                    :show-labels="false"\n                                    :maxHeight="200"\n                                    :loading="sms_loading"\n                                    :allow-empty="false"\n                                    label="text"\n                                    style="max-width: 300px"\n                                >\n                                    <template slot="singleLabel" slot-scope="props">\n                                        <span class="option__desc">\n                                            <span class="option__title" style="line-height: 1.428571">{{ props.option.text}}</span>\n                                        </span>\n                                    </template>\n                                    <template slot="option" slot-scope="props">\n                                        <span class="option__desc">\n                                            <span class="option__title" style="line-height: 1.428571">{{ props.option.text }}</span>\n                                        </span>\n                                    </template>\n                                </multiselect>\n                                <div class="text-center ml-auto me-auto mt-3" v-if="message_type.value==\'one\'">\n                                    <b-form-input\n                                        type="text"\n                                        placeholder="Введите номер телефона клиента"\n                                        name="phone"\n                                        v-model="phone"\n                                        required\n                                        :disabled="sms_loading"\n                                        pattern="[\\+]\\d{2} [\\(]\\d{3}[\\)] \\d{3}[\\-]\\d{2}[\\-]\\d{2}"\n                                        v-mask="[\'+# (###) ###-##-##\',\'+## (###) ###-##-##\']"\n                                    >\n                                    </b-form-input>\n\n                                </div>\n                                <div class="ml-auto me-auto" v-if="message_type.value==\'file\'">\n                                    <div class="row">\n                                        <div class="col-lg-12 my-1">\n                                            <div class="filezone" v-if="file==null">\n                                                <input type="file" id="file" ref="file" v-on:change="handleFiles()" :disabled="sms_loading"/>\n                                                <p>\n                                                    Перетащите файл сюда <br>или нажмите для поиска\n                                                </p>\n                                            </div>\n                                            <div class="list-group-item flex-column align-items-start" style="border-radius: 0.25rem;" v-if="file!=null">\n                                                <div class="row pt-5 pb-5">\n                                                    <div class="col-6">\n                                                        <p class="mb-1">\n                                                            <span class="amount">Файл: {{this.file.name}}</span>\n                                                        </p>\n                                                    </div>\n                                                    <div class="col-6">\n                                                        <div class="remove-container" style="float: right;">\n                                                            <a class="remove" style="color: red;cursor: pointer;" v-on:click="removeFile()">Удалить</a>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <hr>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="col-md-12">\n                                <label class="control-label">Сообщение: </label>\n                                <div class="row w-100 text-center m-auto">\n                                    <textarea\n                                        id="textarea"\n                                        v-model="message"\n                                        placeholder="Введите сообщение..."\n                                        rows="4"\n                                        max-rows="8"\n                                        class="w-100 p-2 m-auto travel-input"\n                                        style="border-radius: 20px !important;"\n                                        :disabled="sms_loading">\n                                    </textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                    </div>\n                 \x3c!--   <div class="row justify-content-center mt-3 mb-4 text-center" slot="footer">--\x3e\n                    <b-button class="btn btn-travel float-right" slot="footer" @click="sendSms" :disabled="sms_loading">\n                        <div class="row align-items-center m-auto w-100 h-100">\n                            <span v-if="sms_loading" role="status" aria-hidden="true" class="spinner-border spinner-border-sm mx-2"></span>\n                            <span v-if="sms_loading" class="sr-only">Loading...</span>\n                            Отправить\n                        </div>\n                    </b-button>\n                    \x3c!--                        </div>--\x3e\n                </card>\n            </div>\n        </div>\n        <div class="row w-100 mx-auto">\n            <div class="col-md-12">\n                <div class="row mx-auto mt-3 mb-5 justify-content-center align-items-center" style="width: 100%;border-top: 4px solid #f08b23;">\n                    <span class="white--text active-tour" style="background:#062348; font-size: 24px;position: absolute">Профиль</span>\n                </div>\n            </div>\n            <div class="col-md-12">\n                <ValidationObserver v-slot="{ invalid }">\n                    <card v-if="user != null && info != null">\n                        <div class="row p-2 m-auto">\n                            <div class="col-md-4 pe-md-1">\n                                <ValidationProvider name="lastName" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Фамилия" label-size="sm" class="mb-0">\n                                        <b-form-input label="Фамилия"\n                                                    v-model="info.LastName"\n                                                    placeholder="Фамилия"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 px-md-1">\n                                <ValidationProvider name="firstName" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Имя" label-size="sm" class="mb-0">\n                                        <b-form-input label="Имя"\n                                                    v-model="info.FirstName"\n                                                    placeholder="Имя"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 ps-md-1">\n                                <b-form-group label="Отчество" label-size="sm" class="mb-0">\n                                    <b-form-input label="Отчество"\n                                                v-model="info.MiddleName"\n                                                placeholder="Отчество"\n                                                class="mb-0 travel-input"\n                                    >\n                                    </b-form-input>\n                                </b-form-group>\n                            </div>\n                        </div>\n                        <div class="row p-2 m-auto">\n\x3c!--                            <div class="col-md-4 pe-md-1">--\x3e\n\x3c!--                                <ValidationProvider name="login" rules="required" v-slot="{ errors }" style="width:100%;">--\x3e\n\x3c!--                                    <b-form-input label="Логин"--\x3e\n\x3c!--                                                placeholder="Логин"--\x3e\n\x3c!--                                                v-model="user.login"--\x3e\n\x3c!--                                                disabled--\x3e\n\x3c!--                                                class="mb-0"--\x3e\n\x3c!--                                    >--\x3e\n\x3c!--                                    </b-form-input>--\x3e\n\x3c!--                                    <span class="validate-error">{{ errors[0] }}</span>--\x3e\n\x3c!--                                </ValidationProvider>--\x3e\n\x3c!--                            </div>--\x3e\n                            <div class="col-md-4 pe-md-1">\n                                <ValidationProvider name="email" rules="required|email" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Email" label-size="sm" class="mb-0">\n                                        <b-form-input label="Email"\n                                                    type="email"\n                                                    placeholder="client@email.com"\n                                                    v-model="user.email"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 px-md-1">\n                                <ValidationProvider name="phone" rules="required|phone" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Телефон" label-size="sm" class="mb-0">\n                                        <b-form-input label="Телефон"\n                                                    placeholder="Телефон"\n                                                    v-model="info.Phone"\n                                                      v-mask="[\'+# (###) ###-##-##\',\'+## (###) ###-##-##\']"\n                                                    class="mb-0 travel-input"\n                                        >\n                                        </b-form-input>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                        </div>\n                        <div class="row p-2 m-auto">\n                            <div class="col-md-4 pe-md-1">\n                                <ValidationProvider name="City" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Город" label-size="sm" class="mb-0">\n                                        <multiselect\n                                            v-model="info.City"\n                                            :options="branches"\n                                            :option-height="25"\n                                            placeholder="Выберите город"\n                                            :show-labels="false"\n                                            :maxHeight="200"\n                                            :loading="branches.length===0"\n                                            :disabled="branches.length===0"\n                                            :allow-empty="false"\n                                            track-by="city"\n                                            label="city"\n                                            @input="selectCity(info)"\n                                        >\n                                            <template slot="singleLabel" slot-scope="props">\n                                                <span class="option__desc">\n                                                    <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571" v-if="props.option.city">{{ props.option.city}}</span>\n                                                </span>\n                                            </template>\n                                            <template slot="option" slot-scope="props">\n                                                <span class="option__desc">\n                                                    <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571">{{ props.option.city}}</span>\n                                                </span>\n                                            </template>\n                                        </multiselect>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                            <div class="col-md-4 px-md-1">\n                                <ValidationProvider name="department" rules="required" v-slot="{ errors }" style="width:100%;">\n                                    <b-form-group label="Отделение" label-size="sm" class="mb-0">\n                                        <multiselect\n                                            v-model="info.Department"\n                                            :options="info.City.departments"\n                                            :option-height="25"\n                                            placeholder="Выберите отделение"\n                                            :show-labels="false"\n                                            :maxHeight="200"\n                                            :disabled="info.City.departments.length===0"\n                                            :allow-empty="false"\n                                            label="address"\n                                            track-by="address"\n                                        >\n                                            <template slot="singleLabel" slot-scope="props">\n                                                    <span class="option__desc">\n                                                        <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571">{{ props.option.address}}</span>\n                                                    </span>\n                                            </template>\n                                            <template slot="option" slot-scope="props">\n                                                    <span class="option__desc">\n                                                        <span class="option__title" style="font-size: 0.7500000025rem;line-height: 1.428571">{{ props.option.address }}</span>\n                                                    </span>\n                                            </template>\n                                        </multiselect>\n                                    </b-form-group>\n                                    <span class="validate-error">{{ errors[0] }}</span>\n                                </ValidationProvider>\n                            </div>\n                        </div>\n                        <b-button class="btn btn-travel float-right" slot="footer" @click="updateInfo" :disabled="loading || invalid">\n                            <div class="row align-items-center m-auto w-100 h-100">\n                                <span v-if="loading" role="status" aria-hidden="true" class="spinner-border spinner-border-sm mx-2"></span>\n                                Сохранить\n                            </div>\n                        </b-button>\n                    </card>\n                </ValidationObserver>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    import {mask} from \'vue-the-mask\'\n    export default {\n        name: "Main",\n        data() {\n            return {\n                clients:0,\n                managers: 0,\n                myclients:0,\n                loading:false,\n                sms_loading: false,\n                message_type: { text: \'Всем клиентам\', value: \'all\' },\n                options: [\n                    { text: \'Всем клиентам\', value: \'all\' },\n                    { text: \'Одному клиенту\', value: \'one\' },\n                    { text: \'Клиентам из файла\', value: \'file\' }\n                ],\n                phone:\'\',\n                phones: [],\n                file: null,\n                message: \'Сообщение от TravelClub: \',\n                email:\'\',\n                info:null,\n            }\n        },\n        created() {\n\n        },\n        mounted() {\n            this.getUser();\n            this.getStatistics();\n            if(this.branches.length<=0){\n                this.loadBranches();\n            }\n            // if(!this.user || this.user==null)\n            // {\n            //     this.$store.dispatch(\'getUser\').then( () => {\n            //         // this.myclients = this.user.isManagerForCount;\n            //     });\n            // }\n\n            // this.myclients = this.user.isManagerForCount;\n        },\n        computed:\n            {\n                menu() {\n                    return this.$store.getters.menu\n                },\n                isAdmin : function(){ return this.$store.getters.isAdmin},\n                user() {\n                    return this.$store.getters.user\n                },\n                branches(){\n                    return this.$store.getters.branches\n                }\n                // fullName() {\n                //     return this.info.LastName+\' \'+ this.info.FirstName+\' \'+this.info.MiddleName\n                // }\n            },\n        methods: {\n            async getUser() {\n\n                if(!this.user || this.user==null)\n                {\n                    await this.$store.dispatch(\'getUser\').then( () => {\n                        // console.log(\'getUser\')\n                        this.info = this.user.info;\n                        this.myclients = this.user.isManagerForCount;\n                    });\n\n                }\n                else {\n                    this.info = this.user.info;\n                    this.myclients = this.user.isManagerForCount;\n                }\n            },\n            async getStatistics() {\n                await axios.get(\'auth/statistics\').then((resp) => {\n                    this.clients = resp.data.clients;\n                    this.managers = resp.data.managers\n                });\n            },\n            async loadBranches() {\n                await this.$store.dispatch(\'setBranches\')\n            },\n            async selectCity(item) {\n                item.Department = \'\';\n            },\n\n            //info\n            updateInfo() {\n                this.loading=true;\n                this.info.FullName = this.info.LastName+\' \'+ this.info.FirstName+\' \'+this.info.MiddleName;\n                var param = {\n                    id: this.user.id,\n                    value: this.user.email,\n                    key: \'email\',\n                }\n                this.$store.dispatch(\'saveUser\', param)\n                this.$store.dispatch(\'updateClientInfo\', this.info)\n                    .then(response => {\n                        this.loading= false;\n\n                        // let foundIndex = this.addresses.findIndex(item => item.department === this.info.Department);\n                        // this.department = this.addresses[foundIndex]\n                        this.sendMessage(\'Ваши личные данные успешно обновлены\');\n                    });\n            },\n\n            changeMessageType(){\n                this.phones=[];\n                this.file = null;\n            },\n            handleFiles() {\n                let uploadedFiles = this.$refs.file.files;\n                if (/\\.(xlsx|xls)$/i.test(uploadedFiles[0].name))\n                {\n                    this.file = uploadedFiles[0];\n                }\n                else\n                {\n                    this.sendMessage(\'Неверный формат файла\', \'error\')\n                }\n\n            },\n            removeFile(){\n                this.file = null;\n            },\n            sendSms() {\n                this.sms_loading = true;\n                if(this.phones !== [] && this.message !== \'\')\n                {\n                    if(this.message_type.value === \'all\'){\n                        axios\n                            .get(`auth/manager/getPhones`)\n                            .then(resp => {\n                                this.phones = resp.data.phones;\n                                this.sendMessage(resp.data.message);\n                            });\n                    }\n                    if(this.message_type.value === \'one\'){\n                        this.phones = [];\n                        this.phones.push(this.phone);\n                    }\n                    if(this.message_type.value === \'file\'){\n                        let formData = new FormData();\n                        formData.append(\'file\', this.file);\n                        axios.post(`auth/manager/uploadPhones`,\n                            formData,\n                            {\n                                headers: {\n                                    \'Content-Type\': \'multipart/form-data\'\n                                }\n                            })\n                            .then(resp => {\n                                this.sendMessage(resp.data.message);\n                                this.phones = resp.data.phones;\n                                console.log(this.phones)\n                            });\n                    }\n                    axios.post(`auth/manager/sendSmsMessage`, {\n                        message: this.message,\n                        phones: this.phones\n                    }).then(resp => {\n                        this.sendMessage(resp.data.message);\n                    });\n                }\n                this.sms_loading = false;\n            },\n            sendMessage(message, type=\'travel\') {\n                this.$notify({\n                    group: \'info\',\n                    type: type,\n                    title: \'Сообщение от TravelClub\',\n                    text: message\n                });\n            },\n        },\n        directives: {mask}\n\n    }\n<\/script>\n\x3c!--<style scoped lang="scss" src="@/sass/black-dashboard.scss">--\x3e\n\n\x3c!--</style>--\x3e\n<style scoped>\n    .card {\n        margin-top: 0 !important;\n    }\n    .card .card-header .card-category {\n        color: #F08B23;\n    }\n    .white-content .card:not(.card-white) .card-header .card-title {\n        color: #0d274b;\n        font-weight: 600;\n    }\n    .white--text {\n        color: #fff !important;\n        caret-color: #fff !important;\n    }\n    .active-tour {\n        background: #f08b23;\n        border-radius: 20px;\n        padding: 3px 20px;\n        -webkit-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);\n        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);\n        font-weight: 900;\n        text-transform: uppercase;\n        font-family: \'Open Sans\';\n    }\n</style>\n<style>\n    /*#manager-profile .multiselect__tags {*/\n    /*    border-color: rgba(29, 37, 59, 0.5) !important;*/\n    /*}*/\n    #manager-profile .multiselect__option.multiselect__option--group.multiselect__option--disabled{\n        text-align: center;\n        background: white !important;\n        color:#f08b23 !important;\n    }\n    #manager-profile .multiselect__option--highlight::after {\n        background: #f08b2300;\n    }\n    #manager-profile .multiselect__option--highlight{\n        background: #f08b23;\n    }\n</style>\n'],sourceRoot:""}]);const o=r},19140:(e,n,t)=>{t.r(n),t.d(n,{default:()=>h});function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(){a=function(){return n};var e,n={},t=Object.prototype,i=t.hasOwnProperty,r=Object.defineProperty||function(e,n,t){e[n]=t.value},o="function"==typeof Symbol?Symbol:{},l=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",d=o.toStringTag||"@@toStringTag";function p(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{p({},"")}catch(e){p=function(e,n,t){return e[n]=t}}function m(e,n,t,s){var a=n&&n.prototype instanceof x?n:x,i=Object.create(a.prototype),o=new z(s||[]);return r(i,"_invoke",{value:P(e,t,o)}),i}function u(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}n.wrap=m;var h="suspendedStart",f="suspendedYield",v="executing",g="completed",b={};function x(){}function y(){}function _(){}var w={};p(w,l,(function(){return this}));var C=Object.getPrototypeOf,A=C&&C(C($([])));A&&A!==t&&i.call(A,l)&&(w=A);var k=_.prototype=x.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(n){p(e,n,(function(e){return this._invoke(n,e)}))}))}function F(e,n){function t(a,r,o,l){var c=u(e[a],e,r);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==s(p)&&i.call(p,"__await")?n.resolve(p.__await).then((function(e){t("next",e,o,l)}),(function(e){t("throw",e,o,l)})):n.resolve(p).then((function(e){d.value=e,o(d)}),(function(e){return t("throw",e,o,l)}))}l(c.arg)}var a;r(this,"_invoke",{value:function(e,s){function i(){return new n((function(n,a){t(e,s,n,a)}))}return a=a?a.then(i,i):i()}})}function P(n,t,s){var a=h;return function(i,r){if(a===v)throw Error("Generator is already running");if(a===g){if("throw"===i)throw r;return{value:e,done:!0}}for(s.method=i,s.arg=r;;){var o=s.delegate;if(o){var l=M(o,s);if(l){if(l===b)continue;return l}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(a===h)throw a=g,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;var c=u(n,t,s);if("normal"===c.type){if(a=s.done?g:f,c.arg===b)continue;return{value:c.arg,done:s.done}}"throw"===c.type&&(a=g,s.method="throw",s.arg=c.arg)}}}function M(n,t){var s=t.method,a=n.iterator[s];if(a===e)return t.delegate=null,"throw"===s&&n.iterator.return&&(t.method="return",t.arg=e,M(n,t),"throw"===t.method)||"return"!==s&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+s+"' method")),b;var i=u(a,n.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,b;var r=i.arg;return r?r.done?(t[n.resultName]=r.value,t.next=n.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,b):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function N(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function L(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function $(n){if(n||""===n){var t=n[l];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,r=function t(){for(;++a<n.length;)if(i.call(n,a))return t.value=n[a],t.done=!1,t;return t.value=e,t.done=!0,t};return r.next=r}}throw new TypeError(s(n)+" is not iterable")}return y.prototype=_,r(k,"constructor",{value:_,configurable:!0}),r(_,"constructor",{value:y,configurable:!0}),y.displayName=p(_,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===y||"GeneratorFunction"===(n.displayName||n.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,d,"GeneratorFunction")),e.prototype=Object.create(k),e},n.awrap=function(e){return{__await:e}},S(F.prototype),p(F.prototype,c,(function(){return this})),n.AsyncIterator=F,n.async=function(e,t,s,a,i){void 0===i&&(i=Promise);var r=new F(m(e,t,s,a),i);return n.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},S(k),p(k,d,"Generator"),p(k,l,(function(){return this})),p(k,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var n=Object(e),t=[];for(var s in n)t.push(s);return t.reverse(),function e(){for(;t.length;){var s=t.pop();if(s in n)return e.value=s,e.done=!1,e}return e.done=!0,e}},n.values=$,z.prototype={constructor:z,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!n)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var t=this;function s(s,a){return o.type="throw",o.arg=n,t.next=s,a&&(t.method="next",t.arg=e),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],o=r.completion;if("root"===r.tryLoc)return s("end");if(r.tryLoc<=this.prev){var l=i.call(r,"catchLoc"),c=i.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return s(r.catchLoc,!0);if(this.prev<r.finallyLoc)return s(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return s(r.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return s(r.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var a=s;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var r=a?a.completion:{};return r.type=e,r.arg=n,a?(this.method="next",this.next=a.finallyLoc,b):this.complete(r)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),b},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),L(t),b}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var s=t.completion;if("throw"===s.type){var a=s.arg;L(t)}return a}}throw Error("illegal catch attempt")},delegateYield:function(n,t,s){return this.delegate={iterator:$(n),resultName:t,nextLoc:s},"next"===this.method&&(this.arg=e),b}},n}function i(e,n,t,s,a,i,r){try{var o=e[i](r),l=o.value}catch(e){return void t(e)}o.done?n(l):Promise.resolve(l).then(s,a)}function r(e){return function(){var n=this,t=arguments;return new Promise((function(s,a){var r=e.apply(n,t);function o(e){i(r,s,a,o,l,"next",e)}function l(e){i(r,s,a,o,l,"throw",e)}o(void 0)}))}}const o={name:"Main",data:function(){return{clients:0,managers:0,myclients:0,loading:!1,sms_loading:!1,message_type:{text:"Всем клиентам",value:"all"},options:[{text:"Всем клиентам",value:"all"},{text:"Одному клиенту",value:"one"},{text:"Клиентам из файла",value:"file"}],phone:"",phones:[],file:null,message:"Сообщение от TravelClub: ",email:"",info:null}},created:function(){},mounted:function(){this.getUser(),this.getStatistics(),this.branches.length<=0&&this.loadBranches()},computed:{menu:function(){return this.$store.getters.menu},isAdmin:function(){return this.$store.getters.isAdmin},user:function(){return this.$store.getters.user},branches:function(){return this.$store.getters.branches}},methods:{getUser:function(){var e=this;return r(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.user&&null!=e.user){n.next=5;break}return n.next=3,e.$store.dispatch("getUser").then((function(){e.info=e.user.info,e.myclients=e.user.isManagerForCount}));case 3:n.next=7;break;case 5:e.info=e.user.info,e.myclients=e.user.isManagerForCount;case 7:case"end":return n.stop()}}),n)})))()},getStatistics:function(){var e=this;return r(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,axios.get("auth/statistics").then((function(n){e.clients=n.data.clients,e.managers=n.data.managers}));case 2:case"end":return n.stop()}}),n)})))()},loadBranches:function(){var e=this;return r(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("setBranches");case 2:case"end":return n.stop()}}),n)})))()},selectCity:function(e){return r(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.Department="";case 1:case"end":return n.stop()}}),n)})))()},updateInfo:function(){var e=this;this.loading=!0,this.info.FullName=this.info.LastName+" "+this.info.FirstName+" "+this.info.MiddleName;var n={id:this.user.id,value:this.user.email,key:"email"};this.$store.dispatch("saveUser",n),this.$store.dispatch("updateClientInfo",this.info).then((function(n){e.loading=!1,e.sendMessage("Ваши личные данные успешно обновлены")}))},changeMessageType:function(){this.phones=[],this.file=null},handleFiles:function(){var e=this.$refs.file.files;/\.(xlsx|xls)$/i.test(e[0].name)?this.file=e[0]:this.sendMessage("Неверный формат файла","error")},removeFile:function(){this.file=null},sendSms:function(){var e=this;if(this.sms_loading=!0,this.phones!==[]&&""!==this.message){if("all"===this.message_type.value&&axios.get("auth/manager/getPhones").then((function(n){e.phones=n.data.phones,e.sendMessage(n.data.message)})),"one"===this.message_type.value&&(this.phones=[],this.phones.push(this.phone)),"file"===this.message_type.value){var n=new FormData;n.append("file",this.file),axios.post("auth/manager/uploadPhones",n,{headers:{"Content-Type":"multipart/form-data"}}).then((function(n){e.sendMessage(n.data.message),e.phones=n.data.phones,console.log(e.phones)}))}axios.post("auth/manager/sendSmsMessage",{message:this.message,phones:this.phones}).then((function(n){e.sendMessage(n.data.message)}))}this.sms_loading=!1},sendMessage:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"travel";this.$notify({group:"info",type:n,title:"Сообщение от TravelClub",text:e})}},directives:{mask:t(29928).mask}};var l=t(85072),c=t.n(l),d=t(17923),p={insert:"head",singleton:!1};c()(d.A,p);d.A.locals;var m=t(51319),u={insert:"head",singleton:!1};c()(m.A,u);m.A.locals;const h=(0,t(14486).A)(o,(function(){var e=this,n=e._self._c;return n("div",{staticClass:"container m-auto",staticStyle:{height:"100%"},attrs:{id:"manager-profile"}},[n("div",{staticClass:"row w-100 mx-auto mb-4"},[e.isAdmin?n("div",{staticClass:"col-lg-4"},[n("div",{staticClass:"card card-chart mb-2"},[n("div",{staticClass:"card-header"},[n("h5",{staticClass:"card-category"},[e._v("Менеджеров")]),e._v(" "),n("h3",{staticClass:"card-title"},[e._v("\n                            "+e._s(e.managers)+"\n                        ")])])])]):e._e(),e._v(" "),n("div",{staticClass:"col-lg-4"},[n("div",{staticClass:"card card-chart mb-2"},[n("div",{staticClass:"card-header"},[n("h5",{staticClass:"card-category"},[e._v("Клиентов")]),e._v(" "),n("h3",{staticClass:"card-title"},[e._v("\n                            "+e._s(e.clients)+"\n                        ")])])])])]),e._v(" "),n("div",{staticClass:"row w-100 mx-auto"},[e._m(0),e._v(" "),n("div",{staticClass:"col-lg-12"},[n("card",{staticClass:"mb-3"},[n("div",{staticClass:"lw-dashboard-card"},[n("div",{staticClass:"row p-2 m-auto",staticStyle:{width:"100%"}},[n("div",{staticClass:"col-md-12"},[n("label",{staticClass:"control-label"},[e._v("Выберите тип смс рассылки: ")]),e._v(" "),n("multiselect",{staticStyle:{"max-width":"300px"},attrs:{options:e.options,disabled:e.sms_loading,"option-height":25,placeholder:"Выберите тип смс рассылки","show-labels":!1,maxHeight:200,loading:e.sms_loading,"allow-empty":!1,label:"text"},on:{change:e.changeMessageType},scopedSlots:e._u([{key:"singleLabel",fn:function(t){return[n("span",{staticClass:"option__desc"},[n("span",{staticClass:"option__title",staticStyle:{"line-height":"1.428571"}},[e._v(e._s(t.option.text))])])]}},{key:"option",fn:function(t){return[n("span",{staticClass:"option__desc"},[n("span",{staticClass:"option__title",staticStyle:{"line-height":"1.428571"}},[e._v(e._s(t.option.text))])])]}}]),model:{value:e.message_type,callback:function(n){e.message_type=n},expression:"message_type"}}),e._v(" "),"one"==e.message_type.value?n("div",{staticClass:"text-center ml-auto me-auto mt-3"},[n("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:["+# (###) ###-##-##","+## (###) ###-##-##"],expression:"['+# (###) ###-##-##','+## (###) ###-##-##']"}],attrs:{type:"text",placeholder:"Введите номер телефона клиента",name:"phone",required:"",disabled:e.sms_loading,pattern:"[\\+]\\d{2} [\\(]\\d{3}[\\)] \\d{3}[\\-]\\d{2}[\\-]\\d{2}"},model:{value:e.phone,callback:function(n){e.phone=n},expression:"phone"}})],1):e._e(),e._v(" "),"file"==e.message_type.value?n("div",{staticClass:"ml-auto me-auto"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-12 my-1"},[null==e.file?n("div",{staticClass:"filezone"},[n("input",{ref:"file",attrs:{type:"file",id:"file",disabled:e.sms_loading},on:{change:function(n){return e.handleFiles()}}}),e._v(" "),n("p",[e._v("\n                                                    Перетащите файл сюда "),n("br"),e._v("или нажмите для поиска\n                                                ")])]):e._e(),e._v(" "),null!=e.file?n("div",{staticClass:"list-group-item flex-column align-items-start",staticStyle:{"border-radius":"0.25rem"}},[n("div",{staticClass:"row pt-5 pb-5"},[n("div",{staticClass:"col-6"},[n("p",{staticClass:"mb-1"},[n("span",{staticClass:"amount"},[e._v("Файл: "+e._s(this.file.name))])])]),e._v(" "),n("div",{staticClass:"col-6"},[n("div",{staticClass:"remove-container",staticStyle:{float:"right"}},[n("a",{staticClass:"remove",staticStyle:{color:"red",cursor:"pointer"},on:{click:function(n){return e.removeFile()}}},[e._v("Удалить")])])])])]):e._e(),e._v(" "),n("hr")])])]):e._e()],1),e._v(" "),n("div",{staticClass:"col-md-12"},[n("label",{staticClass:"control-label"},[e._v("Сообщение: ")]),e._v(" "),n("div",{staticClass:"row w-100 text-center m-auto"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"w-100 p-2 m-auto travel-input",staticStyle:{"border-radius":"20px !important"},attrs:{id:"textarea",placeholder:"Введите сообщение...",rows:"4","max-rows":"8",disabled:e.sms_loading},domProps:{value:e.message},on:{input:function(n){n.target.composing||(e.message=n.target.value)}}})])])])]),e._v(" "),n("b-button",{staticClass:"btn btn-travel float-right",attrs:{slot:"footer",disabled:e.sms_loading},on:{click:e.sendSms},slot:"footer"},[n("div",{staticClass:"row align-items-center m-auto w-100 h-100"},[e.sms_loading?n("span",{staticClass:"spinner-border spinner-border-sm mx-2",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v(" "),e.sms_loading?n("span",{staticClass:"sr-only"},[e._v("Loading...")]):e._e(),e._v("\n                            Отправить\n                        ")])])],1)],1)]),e._v(" "),n("div",{staticClass:"row w-100 mx-auto"},[e._m(1),e._v(" "),n("div",{staticClass:"col-md-12"},[n("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(t){var s=t.invalid;return[null!=e.user&&null!=e.info?n("card",[n("div",{staticClass:"row p-2 m-auto"},[n("div",{staticClass:"col-md-4 pe-md-1"},[n("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"lastName",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Фамилия","label-size":"sm"}},[n("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Фамилия",placeholder:"Фамилия"},model:{value:e.info.LastName,callback:function(n){e.$set(e.info,"LastName",n)},expression:"info.LastName"}})],1),e._v(" "),n("span",{staticClass:"validate-error"},[e._v(e._s(s[0]))])]}}],null,!0)})],1),e._v(" "),n("div",{staticClass:"col-md-4 px-md-1"},[n("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"firstName",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Имя","label-size":"sm"}},[n("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Имя",placeholder:"Имя"},model:{value:e.info.FirstName,callback:function(n){e.$set(e.info,"FirstName",n)},expression:"info.FirstName"}})],1),e._v(" "),n("span",{staticClass:"validate-error"},[e._v(e._s(s[0]))])]}}],null,!0)})],1),e._v(" "),n("div",{staticClass:"col-md-4 ps-md-1"},[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Отчество","label-size":"sm"}},[n("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Отчество",placeholder:"Отчество"},model:{value:e.info.MiddleName,callback:function(n){e.$set(e.info,"MiddleName",n)},expression:"info.MiddleName"}})],1)],1)]),e._v(" "),n("div",{staticClass:"row p-2 m-auto"},[n("div",{staticClass:"col-md-4 pe-md-1"},[n("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"email",rules:"required|email"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Email","label-size":"sm"}},[n("b-form-input",{staticClass:"mb-0 travel-input",attrs:{label:"Email",type:"email",placeholder:"client@email.com"},model:{value:e.user.email,callback:function(n){e.$set(e.user,"email",n)},expression:"user.email"}})],1),e._v(" "),n("span",{staticClass:"validate-error"},[e._v(e._s(s[0]))])]}}],null,!0)})],1),e._v(" "),n("div",{staticClass:"col-md-4 px-md-1"},[n("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"phone",rules:"required|phone"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Телефон","label-size":"sm"}},[n("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:["+# (###) ###-##-##","+## (###) ###-##-##"],expression:"['+# (###) ###-##-##','+## (###) ###-##-##']"}],staticClass:"mb-0 travel-input",attrs:{label:"Телефон",placeholder:"Телефон"},model:{value:e.info.Phone,callback:function(n){e.$set(e.info,"Phone",n)},expression:"info.Phone"}})],1),e._v(" "),n("span",{staticClass:"validate-error"},[e._v(e._s(s[0]))])]}}],null,!0)})],1)]),e._v(" "),n("div",{staticClass:"row p-2 m-auto"},[n("div",{staticClass:"col-md-4 pe-md-1"},[n("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"City",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Город","label-size":"sm"}},[n("multiselect",{attrs:{options:e.branches,"option-height":25,placeholder:"Выберите город","show-labels":!1,maxHeight:200,loading:0===e.branches.length,disabled:0===e.branches.length,"allow-empty":!1,"track-by":"city",label:"city"},on:{input:function(n){return e.selectCity(e.info)}},scopedSlots:e._u([{key:"singleLabel",fn:function(t){return[n("span",{staticClass:"option__desc"},[t.option.city?n("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[e._v(e._s(t.option.city))]):e._e()])]}},{key:"option",fn:function(t){return[n("span",{staticClass:"option__desc"},[n("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[e._v(e._s(t.option.city))])])]}}],null,!0),model:{value:e.info.City,callback:function(n){e.$set(e.info,"City",n)},expression:"info.City"}})],1),e._v(" "),n("span",{staticClass:"validate-error"},[e._v(e._s(s[0]))])]}}],null,!0)})],1),e._v(" "),n("div",{staticClass:"col-md-4 px-md-1"},[n("ValidationProvider",{staticStyle:{width:"100%"},attrs:{name:"department",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Отделение","label-size":"sm"}},[n("multiselect",{attrs:{options:e.info.City.departments,"option-height":25,placeholder:"Выберите отделение","show-labels":!1,maxHeight:200,disabled:0===e.info.City.departments.length,"allow-empty":!1,label:"address","track-by":"address"},scopedSlots:e._u([{key:"singleLabel",fn:function(t){return[n("span",{staticClass:"option__desc"},[n("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[e._v(e._s(t.option.address))])])]}},{key:"option",fn:function(t){return[n("span",{staticClass:"option__desc"},[n("span",{staticClass:"option__title",staticStyle:{"font-size":"0.7500000025rem","line-height":"1.428571"}},[e._v(e._s(t.option.address))])])]}}],null,!0),model:{value:e.info.Department,callback:function(n){e.$set(e.info,"Department",n)},expression:"info.Department"}})],1),e._v(" "),n("span",{staticClass:"validate-error"},[e._v(e._s(s[0]))])]}}],null,!0)})],1)]),e._v(" "),n("b-button",{staticClass:"btn btn-travel float-right",attrs:{slot:"footer",disabled:e.loading||s},on:{click:e.updateInfo},slot:"footer"},[n("div",{staticClass:"row align-items-center m-auto w-100 h-100"},[e.loading?n("span",{staticClass:"spinner-border spinner-border-sm mx-2",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v("\n                                Сохранить\n                            ")])])],1):e._e()]}}])})],1)])])}),[function(){var e=this._self._c;return e("div",{staticClass:"col-md-12"},[e("div",{staticClass:"row mx-auto mt-3 mb-5 justify-content-center align-items-center",staticStyle:{width:"100%","border-top":"4px solid #f08b23"}},[e("span",{staticClass:"white--text active-tour",staticStyle:{background:"#062348","font-size":"24px",position:"absolute"}},[this._v("Форма смс рассылки")])])])},function(){var e=this._self._c;return e("div",{staticClass:"col-md-12"},[e("div",{staticClass:"row mx-auto mt-3 mb-5 justify-content-center align-items-center",staticStyle:{width:"100%","border-top":"4px solid #f08b23"}},[e("span",{staticClass:"white--text active-tour",staticStyle:{background:"#062348","font-size":"24px",position:"absolute"}},[this._v("Профиль")])])])}],!1,null,"faa0a646",null).exports}}]);
//# sourceMappingURL=9140.js.map