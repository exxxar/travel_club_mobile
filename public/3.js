(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"50rd":function(t,e,s){"use strict";s("PFFB")},"6Hq2":function(t,e,s){"use strict";s.r(e);var a=s("o0o1"),n=s.n(a),r=s("OmDE");function i(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}function o(t){return function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function o(t){i(r,a,n,o,l,"next",t)}function l(t){i(r,a,n,o,l,"throw",t)}o(void 0)}))}}var l={props:{messages:{type:Array,required:!0,default:function(){return[]}},loading:{type:Boolean,default:!0},totalRows:{type:Number,required:!0,default:0}},data:function(){return{sortBy:"id",sortDesc:!1,currentPage:1,perPage:5,sortDirection:"asc",filter:null,filterOn:[],pageOptions:[5,10,15,25,50,100],tags:[{tag:"Голосовая заявка",style:"background:blue; color:white;"},{tag:"Обратная связь",style:"background:green; color:white;"},{tag:"Обратный звонок",style:"background:red; color:white;"},{tag:"Заявка менеджера",style:"background:#0d274b; color:white;"}],fields:[{key:"id",label:"ID",sortable:!0,sortDirection:"desc"},{key:"created_at",label:"Дата",sortable:!0,sortDirection:"desc"},{key:"name",label:"Имя",sortable:!0,sortDirection:"desc"},{key:"phone",label:"Телефон",sortable:!0,sortDirection:"desc"},{key:"message_type",label:"Тип сообщения",sortable:!0,sortDirection:"desc"},{key:"action1",label:"Показать"},{key:"action2",label:"Действия"}]}},mounted:function(){},computed:{isAdmin:function(){return this.$store.getters.isAdmin},isManager:function(){return this.$store.getters.isManager},sortOptions:function(){return this.fields.filter((function(t){return t.sortable})).map((function(t){return{text:t.label,value:t.key}}))}},methods:{remove:function(t){var e=this;return o(n.a.mark((function s(){return n.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:e.$store.dispatch("removeMessage",t).then((function(t){e.sendMessage(t.data.message)}));case 1:case"end":return s.stop()}}),s)})))()},destroy:function(t){var e=this;return o(n.a.mark((function s(){return n.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:e.$store.dispatch("forceDeleteMessage",t).then((function(t){e.sendMessage(t.data.message)}));case 1:case"end":return s.stop()}}),s)})))()},restore:function(t){var e=this;return o(n.a.mark((function s(){return n.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:e.$store.dispatch("restoreMessage",t).then((function(t){e.sendMessage(t.data.message)}));case 1:case"end":return s.stop()}}),s)})))()},verifyManager:function(t){this.$store.dispatch("saveUser",{id:t,value:1,key:"is_manager"})},unverifyManager:function(t){this.$store.dispatch("saveUser",{id:t,value:0,key:"is_manager"})},sendMessage:function(t){this.$notify({group:"info",type:"travel",title:"Туры пользователей",text:t})},onFiltered:function(t){this.totalRows=t.length,this.currentPage=1}},directives:{mask:r.mask}},c=(s("50rd"),s("HTSp"),s("KHd+"));function u(t,e,s,a,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,n)}var d={components:{MessagesTable:Object(c.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("b-row",[s("b-col",{staticClass:"my-1",attrs:{lg:"6"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Сортировка","label-cols-sm":"3","label-align-sm":"right","label-size":"sm","label-for":"sortBySelect1"}},[s("b-input-group",{attrs:{size:"sm"}},[s("b-form-select",{staticClass:"w-75",attrs:{id:"sortBySelect1",options:t.sortOptions},scopedSlots:t._u([{key:"first",fn:function(){return[s("option",{attrs:{value:""}},[t._v("-- none --")])]},proxy:!0}]),model:{value:t.sortBy,callback:function(e){t.sortBy=e},expression:"sortBy"}}),t._v(" "),s("b-form-select",{staticClass:"w-25",attrs:{size:"sm",disabled:!t.sortBy},model:{value:t.sortDesc,callback:function(e){t.sortDesc=e},expression:"sortDesc"}},[s("option",{domProps:{value:!1}},[t._v("Asc")]),t._v(" "),s("option",{domProps:{value:!0}},[t._v("Desc")])])],1)],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{lg:"6"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"Поиск","label-cols-sm":"3","label-align-sm":"right","label-size":"sm","label-for":"filterInput"}},[s("b-input-group",{attrs:{size:"sm"}},[s("b-form-input",{attrs:{type:"search",id:"filterInput",placeholder:"Введите для поиска"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),s("b-input-group-append",[s("b-button",{attrs:{disabled:!t.filter},on:{click:function(e){t.filter=""}}},[t._v("Очистить")])],1)],1)],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{sm:"5",md:"6"}},[s("b-form-group",{staticClass:"mb-0",attrs:{label:"На странице","label-cols-sm":"6","label-cols-md":"4","label-cols-lg":"3","label-align-sm":"right","label-size":"sm","label-for":"perPageSelect1"}},[s("b-form-select",{attrs:{id:"perPageSelect1",size:"sm",options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{sm:"7",md:"6"}},[s("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage,align:"fill",size:"sm"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1),t._v(" "),s("b-table",{attrs:{"show-empty":"",small:"",stacked:"md",items:t.messages,fields:t.fields,"current-page":t.currentPage,"per-page":t.perPage,filter:t.filter,filterIncludedFields:t.filterOn,"sort-by":t.sortBy,"sort-desc":t.sortDesc,"sort-direction":t.sortDirection,busy:t.loading,"empty-text":"Нет записей для отображения","empty-filtered-text":"Нет записей, соответствующих вашему запросу"},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e},filtered:t.onFiltered},scopedSlots:t._u([{key:"cell(created_at)",fn:function(e){return[t._v("\n            "+t._s(t._f("moment")(e.item.created_at,"DD.MM.YYYY"))+"\n        ")]}},{key:"cell(message_type)",fn:function(e){return[s("div",{staticClass:"tag text-center",class:[{red:"Голосовая заявка"==e.item.message_type},{blue:"Обратная связь"==e.item.message_type},{green:"Обратный звонок"==e.item.message_type},{darkblue:"Заявка менеджера"==e.item.message_type}]},[s("span",[t._v(t._s(e.item.message_type))])])]}},{key:"cell(action1)",fn:function(e){return[s("b-input-group",{attrs:{size:"sm"}},[s("b-button",{staticClass:"w-100 btn btn-travel mr-1 mb-1 btn-travel",on:{click:e.toggleDetails}},[t._v("\n                    "+t._s(e.detailsShowing?"Свернуть":"Развернуть")+"\n                ")])],1)]}},{key:"cell(action2)",fn:function(e){return[s("b-input-group",{attrs:{size:"sm"}},[null==e.item.deleted_at?s("b-button",{staticClass:"btn btn-info mr-1 mb-1 btn-travel w-100",attrs:{disabled:null===e.item.id},on:{click:function(s){return t.remove(e.item.id)}}},[t._v("\n                    Удалить\n                ")]):s("b-button",{staticClass:"btn btn-info mr-1 mb-1 btn-travel w-100",attrs:{disabled:null===e.item.id},on:{click:function(s){return t.restore(e.item.id)}}},[t._v("\n                    Восстановить\n                ")]),t._v(" "),null!=e.item.deleted_at?s("b-button",{staticClass:"btn btn-info mr-1 mb-1 btn-travel w-100",attrs:{disabled:null===e.item.id},on:{click:function(s){return t.destroy(e.item.id)}}},[t._v("\n                    Удалить\n                ")]):t._e()],1)]}},{key:"row-details",fn:function(e){return[s("b-card",[s("div",{staticClass:"row align-items-center justify-content-center m-auto"},["Голосовая заявка"===e.item.message_type?s("div",{staticStyle:{width:"100%",height:"100%"}},[s("audio-player",{attrs:{audio:e.item.file_path}})],1):t._e(),t._v(" "),"Обратная связь"===e.item.message_type?s("div",[s("p",[t._v(t._s(e.item.message))])]):t._e(),t._v(" "),"Обратный звонок"===e.item.message_type?s("div",[s("p",[t._v("Дополнительная информация отсутствует")])]):t._e(),t._v(" "),"Заявка менеджера"===e.item.message_type&&null!=e.item.user&&t.isAdmin?s("div",[s("div",{staticClass:"row w-100 p-2 m-auto"},[s("div",{staticClass:"col-md-4 pr-md-1"},[s("b-input-group",{attrs:{label:"Фамилия"}},[t._v("\n                                    "+t._s(e.item.user.info.LastName)+"\n                                ")])],1),t._v(" "),s("div",{staticClass:"col-md-4 px-md-1"},[s("b-input-group",{attrs:{label:"Имя"}},[t._v("\n                                    "+t._s(e.item.user.info.FirstName)+"\n                                ")])],1),t._v(" "),s("div",{staticClass:"col-md-4 pl-md-1"},[s("b-input-group",{attrs:{label:"Отчество"}},[t._v("\n                                    "+t._s(e.item.user.info.MiddleName)+"\n                                ")])],1)]),t._v(" "),s("div",{staticClass:"row w-100 p-2 m-auto"},[s("b-input-group",{attrs:{label:"Email"}},[t._v("\n                                "+t._s(e.item.user.email)+"\n                            ")]),t._v(" "),s("div",{staticClass:"col-md-4 px-md-1"},[s("b-input-group",{attrs:{label:"Телефон"}},[t._v("\n                                    "+t._s(e.item.user.info.Phone)+"\n                                ")])],1)],1),t._v(" "),s("div",{staticClass:"row w-100 p-2 m-auto"},[s("div",{staticClass:"col-md-4 pr-md-1"},[s("b-input-group",{attrs:{label:"Город"}},[t._v("\n                                    "+t._s(e.item.user.info.City.city)+"\n                                ")])],1),t._v(" "),s("div",{staticClass:"col-md-4 px-md-1"},[s("b-input-group",{attrs:{label:"Отделение"}},[t._v("\n                                    "+t._s(e.item.user.info.Department.address)+"\n                                ")])],1)]),t._v(" "),s("div",{staticClass:"row w-100 p-2 m-auto"},[0==e.item.user.is_manager?s("b-button",[t._v("Подтвердить менеджера")]):s("b-button",[t._v("Отменить менеджера")])],1)]):t._e()])])]}},{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center text-warning my-2"},[s("b-spinner",{staticClass:"align-middle",attrs:{variant:"warning"}}),t._v(" "),s("strong",[t._v("Загрузка...")])],1)]},proxy:!0}])})],1)}),[],!1,null,"c46c1444",null).exports},data:function(){return{loading:!1,messagesTotalRows:0,deletedMessagesTotalRows:0}},computed:{menu:function(){return this.$store.getters.menu},isAdmin:function(){return this.$store.getters.isAdmin},isManager:function(){return this.$store.getters.isManager},messages:function(){return this.$store.getters.messages},deleted_messages:function(){return this.$store.getters.deleted_messages}},created:function(){this.messages.length<=0&&this.setMessages()},mounted:function(){},methods:{setMessages:function(){var t,e=this;return(t=n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.loading=!0,!(e.messages.length<=0)){t.next=4;break}return t.next=4,e.$store.dispatch("setMessages").then((function(){e.messagesTotalRows=e.messages.length,e.deletedMessagesTotalRows=e.deleted_messages.length,e.loading=!1}));case 4:e.loading=!1;case 5:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,n){var r=t.apply(e,s);function i(t){u(r,a,n,i,o,"next",t)}function o(t){u(r,a,n,i,o,"throw",t)}i(void 0)}))})()},verifyManager:function(t){this.$store.dispatch("saveUser",{id:t,value:1,key:"is_manager"})},unverifyManager:function(t){this.$store.dispatch("saveUser",{id:t,value:0,key:"is_manager"})},sendMessage:function(t){this.$notify({group:"info",type:"travel",title:"Сообщение от TravelClub",text:t})}}},m=(s("ph+Y"),Object(c.a)(d,(function(){var t=this.$createElement,e=this._self._c||t;return e("b-container",{attrs:{fluid:""}},[e("b-tabs",{attrs:{"content-class":"mt-3 w-100"}},[e("b-tab",{attrs:{title:"Все",active:""}},[e("messages-table",{attrs:{messages:this.messages,loading:this.loading,totalRows:this.messagesTotalRows}})],1),this._v(" "),e("b-tab",{attrs:{title:"Удаленные"}},[e("messages-table",{attrs:{messages:this.deleted_messages,loading:this.loading,totalRows:this.deletedMessagesTotalRows}})],1)],1)],1)}),[],!1,null,null,null));e.default=m.exports},HBHH:function(t,e,s){(t.exports=s("I1BE")(!1)).push([t.i,".nav-link{color:#f08b23}.nav-link:hover{color:#0d274b}",""])},HTSp:function(t,e,s){"use strict";s("sKZC")},KQET:function(t,e,s){(t.exports=s("I1BE")(!1)).push([t.i,".btn-travel[data-v-c46c1444]{background:#e17e4e;background-position-x:0;background-position-y:0;background-image:none;background-size:auto;background-image:linear-gradient(to bottom left,#e17e4e,#ffbf00,#e17e4e);background-size:210% 210%;background-position:100% 0;background-color:#e17e4e;transition:all .15s ease;box-shadow:none;color:#fff;max-width:300px;border:none}.tag[data-v-c46c1444]{padding:5px 10px;background:#f8a105;color:#fff;border-radius:50px}.red[data-v-c46c1444]{background:red}.blue[data-v-c46c1444]{background:#00008b}.green[data-v-c46c1444]{background:#006f23}.darkblue[data-v-c46c1444]{background:#0d274b}",""])},O3E2:function(t,e,s){var a=s("HBHH");"string"==typeof a&&(a=[[t.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};s("aET+")(a,n);a.locals&&(t.exports=a.locals)},PFFB:function(t,e,s){var a=s("KQET");"string"==typeof a&&(a=[[t.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};s("aET+")(a,n);a.locals&&(t.exports=a.locals)},oiNO:function(t,e,s){(t.exports=s("I1BE")(!1)).push([t.i,".page-item.active .page-link{background:#f08b23;border:1px solid #f08b23;transition:all .15s ease;box-shadow:none;color:#fff}.tours .vhd-input{min-width:100%}",""])},"ph+Y":function(t,e,s){"use strict";s("O3E2")},sKZC:function(t,e,s){var a=s("oiNO");"string"==typeof a&&(a=[[t.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};s("aET+")(a,n);a.locals&&(t.exports=a.locals)}}]);